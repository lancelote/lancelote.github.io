<!DOCTYPE html>
<html prefix="            og: http://ogp.me/ns# article: http://ogp.me/ns/article#     " vocab="http://ogp.me/ns" lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<title>tidyr HOW-TO | Pavel Karateev</title>
<link href="../../../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../../../../rss.xml">
<link rel="canonical" href="http://pavelkarateev.com/posts/2014/12/13/tidyr-how-to/">
<!--[if lt IE 9]><script src="../../../../../assets/js/html5shiv-printshiv.min.js"></script><![endif]--><meta name="author" content="Pavel Karateev">
<link rel="prev" href="../../../11/03/mosaic-plot/" title="Мозаичные диаграммы в ggplot2" type="text/html">
<link rel="next" href="../../../../2015/04/21/djangogirls-ru/" title="Перевод руководства Djangogirls" type="text/html">
<meta property="og:site_name" content="Pavel Karateev">
<meta property="og:title" content="tidyr HOW-TO">
<meta property="og:url" content="http://pavelkarateev.com/posts/2014/12/13/tidyr-how-to/">
<meta property="og:description" content="Шпаргалка возможностей пакета tidyr. 
Содержание

expand
extract
extract_numeric
gather
separate
seq_range
spread
unite
unnest

Общее
Пакет tidyr за авторством Hadley Wickham'а предназначен для первич">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2014-12-13T00:00:00+03:00">
</head>
<body>
    <a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>
    <div id="container">
         
    <header id="header"><h1 id="brand"><a href="http://pavelkarateev.com/" title="Pavel Karateev" rel="home">

        <span id="blog-title">Pavel Karateev</span>
    </a></h1>

        

        
    <nav id="menu"><ul>
<li><a href="../../../../../pages/about">About</a></li>
                <li><a href="https://twitter.com/Lancel0te">Twitter</a></li>
                <li><a href="../../../../../archive.html">Archive</a></li>
                <li><a href="https://github.com/lancelote/lancelote.github.io">Source</a></li>
    
    
    </ul></nav></header><main id="content"><article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">tidyr HOW-TO</a></h1>

        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                    Pavel Karateev
            </span></p>
            <p class="dateline"><a href="." rel="bookmark"><time class="published dt-published" datetime="2014-12-13T00:00:00+03:00" itemprop="datePublished" title="2014-12-13 00:00">2014-12-13 00:00</time></a></p>
            
        <p class="sourceline"><a href="index.md" class="sourcelink">Source</a></p>

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div>
<p>Шпаргалка возможностей пакета <code>tidyr</code>. </p>
<h2>Содержание</h2>
<ol>
<li><a href="#expand">expand</a></li>
<li><a href="#extract">extract</a></li>
<li><a href="#extract_numeric">extract_numeric</a></li>
<li><a href="#gather">gather</a></li>
<li><a href="#separate">separate</a></li>
<li><a href="#seq_range">seq_range</a></li>
<li><a href="#spread">spread</a></li>
<li><a href="#unite">unite</a></li>
<li><a href="#unnest">unnest</a></li>
</ol>
<h2>Общее</h2>
<p>Пакет <code>tidyr</code> за авторством Hadley Wickham'а предназначен для первичной обработки сырых данных, в частности - изменения их структуры. Для начала нам потребуются сам <code>tidyr</code>, а также <code>dplyr</code>:</p>
<pre class="code literal-block"><span></span><span class="kn">library</span><span class="p">(</span>tidyr<span class="p">)</span>
<span class="kn">library</span><span class="p">(</span>dplyr<span class="p">)</span>
</pre>


<p><a name="expand"></a></p>
<h2>expand()</h2>
<h3>Назначение</h3>
<p>Создает <code>data.frame</code> включающий все комбинации заданных переменных без перестановок</p>
<h3>Использование</h3>
<p><code>expand(data, ...)</code></p>
<h3>Аргументы</h3>
<ul>
<li>
<code>data</code> - оригинальный <code>data.frame</code>
</li>
<li>
<code>...</code> - имена переменных для комбинации (допустимы выражения вместо непосредственно имен)</li>
</ul>
<h3>Примеры использования</h3>
<p>Данные:</p>
<pre class="code literal-block"><span></span>df <span class="o">&lt;-</span> <span class="kt">data.frame</span><span class="p">(</span>a <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">5</span><span class="p">),</span> b <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="m">3</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">3</span><span class="p">),</span> <span class="kt">c</span> <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">))</span>
df
</pre>


<pre class="code literal-block"><span></span>##   a b c
## 1 1 3 1
## 2 2 5 2
## 3 5 3 3
</pre>


<p>Все комбинации переменных <code>vs</code> и <code>cyl</code>:</p>
<pre class="code literal-block"><span></span>expand<span class="p">(</span>mtcars<span class="p">,</span> vs<span class="p">,</span> cyl<span class="p">)</span>
</pre>


<pre class="code literal-block"><span></span>##   vs cyl
## 1  0   4
## 2  0   6
## 3  0   8
## 4  1   4
## 5  1   6
## 6  1   8
</pre>


<p>Все комбинации переменных <code>cyl</code> и <code>mpg</code>, последняя при этом принимает только минимальное или максимальное значение:</p>
<pre class="code literal-block"><span></span>expand<span class="p">(</span>mtcars<span class="p">,</span> cyl<span class="p">,</span> mpg <span class="o">=</span> seq_range<span class="p">(</span>mpg<span class="p">,</span> <span class="m">2</span><span class="p">))</span>
</pre>


<pre class="code literal-block"><span></span>##   cyl  mpg
## 1   4 10.4
## 2   4 33.9
## 3   6 10.4
## 4   6 33.9
## 5   8 10.4
## 6   8 33.9
</pre>


<p>Все комбинации переменных <code>cyl</code> и <code>mpg</code>, последняя при этом принимает значения из разбитого на 5 равных частей диапазона:</p>
<pre class="code literal-block"><span></span>expand<span class="p">(</span>mtcars<span class="p">,</span> cyl<span class="p">,</span> mpg <span class="o">=</span> seq_range<span class="p">(</span>mpg<span class="p">,</span> <span class="m">5</span><span class="p">))</span>
</pre>


<pre class="code literal-block"><span></span>##    cyl    mpg
## 1    4 10.400
## 2    4 16.275
## 3    4 22.150
## 4    4 28.025
## 5    4 33.900
## 6    6 10.400
## 7    6 16.275
## 8    6 22.150
## 9    6 28.025
## 10   6 33.900
## 11   8 10.400
## 12   8 16.275
## 13   8 22.150
## 14   8 28.025
## 15   8 33.900
</pre>


<p>Все комбинации переменных <code>a</code>, <code>b</code> и <code>c</code>:</p>
<pre class="code literal-block"><span></span>expand<span class="p">(</span>df<span class="p">)</span>
</pre>


<pre class="code literal-block"><span></span>##    a b c
## 1  1 3 1
## 2  1 3 2
## 3  1 3 3
## 4  1 5 1
## 5  1 5 2
## 6  1 5 3
## 7  2 3 1
## 8  2 3 2
## 9  2 3 3
## 10 2 5 1
## 11 2 5 2
## 12 2 5 3
## 13 5 3 1
## 14 5 3 2
## 15 5 3 3
## 16 5 5 1
## 17 5 5 2
## 18 5 5 3
</pre>


<p>Все комбинации переменных <code>a</code> и <code>b</code>:</p>
<pre class="code literal-block"><span></span>expand<span class="p">(</span>df<span class="p">,</span> a<span class="p">,</span> b<span class="p">)</span>
</pre>


<pre class="code literal-block"><span></span>##   a b
## 1 1 3
## 2 1 5
## 3 2 3
## 4 2 5
## 5 5 3
## 6 5 5
</pre>


<p>Все комбинации переменных <code>a</code> и <code>c</code>:</p>
<pre class="code literal-block"><span></span>expand<span class="p">(</span>df<span class="p">,</span> a<span class="p">,</span> <span class="kt">c</span><span class="p">)</span>
</pre>


<pre class="code literal-block"><span></span>##   a c
## 1 1 1
## 2 1 2
## 3 1 3
## 4 2 1
## 5 2 2
## 6 2 3
## 7 5 1
## 8 5 2
## 9 5 3
</pre>


<p>Все комбинации переменных <code>b</code> и <code>c</code>:</p>
<pre class="code literal-block"><span></span>expand<span class="p">(</span>df<span class="p">,</span> b<span class="p">,</span> <span class="kt">c</span><span class="p">)</span>
</pre>


<pre class="code literal-block"><span></span>##   b c
## 1 3 1
## 2 3 2
## 3 3 3
## 4 5 1
## 5 5 2
## 6 5 3
</pre>


<p><a name="extract"></a></p>
<h2>extract()</h2>
<h3>Назначение</h3>
<p>Применяет регулярное выражение к переменной и создает одну или несколько новых на основе результата</p>
<h3>Использование</h3>
<pre class="code literal-block"><span></span>extract(data, col, into, regex = "([[:alnum:]]+)", remove = TRUE,
        convert = FALSE, ...)
</pre>


<h3>Аргументы</h3>
<ul>
<li>
<code>data</code> - оригинальный <code>data.frame</code>
</li>
<li>
<code>col</code> - имя переменной</li>
<li>
<code>into</code> - имена новых переменных</li>
<li>
<code>regex</code> - регулярное выражение для поиска требуемых данных</li>
<li>
<code>remove</code> - если <code>TRUE</code> - удаляет <code>col</code> из результирующего <code>data.frame</code>
</li>
<li>
<code>convert</code> - если <code>TRUE</code> - применяет <code>type.convert</code> c <code>as.is = TRUE</code> к новым переменным</li>
<li>
<code>...</code> - дополнительные аргументы для <code>regexec</code>
</li>
</ul>
<h3>Примеры использования</h3>
<p>Данные:</p>
<pre class="code literal-block"><span></span>df <span class="o">&lt;-</span> <span class="kt">data.frame</span><span class="p">(</span>x <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="s">"a.b"</span><span class="p">,</span> <span class="s">"a.d"</span><span class="p">,</span> <span class="s">"b.c"</span><span class="p">))</span>
df
</pre>


<pre class="code literal-block"><span></span>##     x
## 1 a.b
## 2 a.d
## 3 b.c
</pre>


<p>Извлечь из переменной <code>x</code> первую букву:</p>
<pre class="code literal-block"><span></span>df <span class="o">%&gt;%</span> extract<span class="p">(</span>x<span class="p">,</span> <span class="s">"A"</span><span class="p">)</span>
</pre>


<pre class="code literal-block"><span></span>##   A
## 1 a
## 2 a
## 3 b
</pre>


<p>Разбить переменную <code>x</code>:</p>
<pre class="code literal-block"><span></span>df <span class="o">%&gt;%</span> extract<span class="p">(</span>x<span class="p">,</span> <span class="kt">c</span><span class="p">(</span><span class="s">"A"</span><span class="p">,</span> <span class="s">"B"</span><span class="p">),</span> <span class="s">"([[:alnum:]]+)\\.([[:alnum:]]+)"</span><span class="p">)</span>
</pre>


<pre class="code literal-block"><span></span>##   A B
## 1 a b
## 2 a d
## 3 b c
</pre>


<p><a name="extract_numeric"></a></p>
<h2>extract_numeric()</h2>
<h3>Назначение</h3>
<p>Используя регулярное выражение удаляет все нецифровые знаки из строки и трансформирует результат в число</p>
<h3>Использование</h3>
<pre class="code literal-block"><span></span>extract_numeric(x)
</pre>


<h3>Аргументы</h3>
<ul>
<li>
<code>x</code> - <code>character vector</code> или <code>factor</code>
</li>
</ul>
<h3>Примеры использования</h3>
<pre class="code literal-block"><span></span>extract_numeric<span class="p">(</span><span class="s">"$1,200.34"</span><span class="p">)</span>
</pre>


<pre class="code literal-block"><span></span>## [1] 1200.34
</pre>


<pre class="code literal-block"><span></span>extract_numeric<span class="p">(</span><span class="s">"-2%"</span><span class="p">)</span>
</pre>


<pre class="code literal-block"><span></span>## [1] -2
</pre>


<p>Может некорректно работать со строками, которые точно не являются цифровыми данными:</p>
<pre class="code literal-block"><span></span>extract_numeric<span class="p">(</span><span class="s">"-2-2"</span><span class="p">)</span>
</pre>


<pre class="code literal-block"><span></span>## Warning in extract_numeric("-2-2"): NAs introduced by coercion
</pre>


<pre class="code literal-block"><span></span>## [1] NA
</pre>


<pre class="code literal-block"><span></span>extract_numeric<span class="p">(</span><span class="s">"12abc34"</span><span class="p">)</span>
</pre>


<pre class="code literal-block"><span></span>## [1] 1234
</pre>


<p><a name="gather"></a></p>
<h2>gather()</h2>
<h3>Назначение</h3>
<p>Объединяет переменные, имена переменных для объединения становятся уровнями переменной <code>key</code>, значения объединенных переменных заполняют соответственно переменную <code>value</code></p>
<h3>Использование</h3>
<pre class="code literal-block"><span></span>gather(data, key, value, ..., na.rm = FALSE, convert = FALSE)
</pre>


<h3>Аргументы</h3>
<ul>
<li>
<code>data</code> - оригинальный <code>data.frame</code>
</li>
<li>
<code>key</code>, <code>value</code> - <code>key</code>, <code>value</code> переменные</li>
<li>
<code>...</code> - переменные для объединения, выбор нескольких: <code>x:z</code>, исключить: <code>-y</code>
</li>
<li>
<code>na.rm</code> - если <code>TRUE</code> - удалить все <code>NA</code>
</li>
<li>
<code>convert</code> - если <code>TRUE</code> - применяет <code>type.convert</code> к <code>key</code> переменной</li>
</ul>
<h3>Примеры использования</h3>
<p>Данные:</p>
<pre class="code literal-block"><span></span>stocks <span class="o">&lt;-</span> <span class="kt">data.frame</span><span class="p">(</span>
time <span class="o">=</span> <span class="kp">as.Date</span><span class="p">(</span><span class="s">'2009-01-01'</span><span class="p">)</span> <span class="o">+</span> <span class="m">0</span><span class="o">:</span><span class="m">9</span><span class="p">,</span>
X <span class="o">=</span> rnorm<span class="p">(</span><span class="m">10</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">1</span><span class="p">),</span>
Y <span class="o">=</span> rnorm<span class="p">(</span><span class="m">10</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">2</span><span class="p">),</span>
Z <span class="o">=</span> rnorm<span class="p">(</span><span class="m">10</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">4</span><span class="p">)</span>
<span class="p">)</span>
stocks
</pre>


<pre class="code literal-block"><span></span>##          time          X          Y           Z
## 1  2009-01-01  0.7722318 -0.3642657 -2.50084998
## 2  2009-01-02 -1.1323590  0.7835050 -1.44378404
## 3  2009-01-03 -0.8616668 -2.5209075  2.19735867
## 4  2009-01-04 -0.6363773 -3.6459329 -2.27906230
## 5  2009-01-05  1.3777546  0.6740792  2.47886088
## 6  2009-01-06  1.1138555 -2.7431003  2.13743541
## 7  2009-01-07 -0.4055423 -0.3971725  0.32445108
## 8  2009-01-08 -0.6551642 -1.3071296 -4.39142177
## 9  2009-01-09 -0.8421454 -0.9334135 -0.02401832
## 10 2009-01-10 -0.1655489 -0.6961085 -0.82861047
</pre>


<p>Объединить имена переменных <code>X</code>, <code>Y</code>, <code>Z</code> в качестве уровней новой переменной <code>stock</code>, значения объединенных переменных заполнят переменную <code>price</code>:</p>
<pre class="code literal-block"><span></span>stocks <span class="o">%&gt;%</span> gather<span class="p">(</span>stock<span class="p">,</span> price<span class="p">,</span> <span class="o">-</span>time<span class="p">)</span>
</pre>


<pre class="code literal-block"><span></span>##          time stock       price
## 1  2009-01-01     X  0.77223178
## 2  2009-01-02     X -1.13235898
## 3  2009-01-03     X -0.86166677
## 4  2009-01-04     X -0.63637728
## 5  2009-01-05     X  1.37775462
## 6  2009-01-06     X  1.11385552
## 7  2009-01-07     X -0.40554232
## 8  2009-01-08     X -0.65516418
## 9  2009-01-09     X -0.84214541
## 10 2009-01-10     X -0.16554890
## 11 2009-01-01     Y -0.36426573
## 12 2009-01-02     Y  0.78350495
## 13 2009-01-03     Y -2.52090748
## 14 2009-01-04     Y -3.64593285
## 15 2009-01-05     Y  0.67407924
## 16 2009-01-06     Y -2.74310035
## 17 2009-01-07     Y -0.39717249
## 18 2009-01-08     Y -1.30712963
## 19 2009-01-09     Y -0.93341350
## 20 2009-01-10     Y -0.69610847
## 21 2009-01-01     Z -2.50084998
## 22 2009-01-02     Z -1.44378404
## 23 2009-01-03     Z  2.19735867
## 24 2009-01-04     Z -2.27906230
## 25 2009-01-05     Z  2.47886088
## 26 2009-01-06     Z  2.13743541
## 27 2009-01-07     Z  0.32445108
## 28 2009-01-08     Z -4.39142177
## 29 2009-01-09     Z -0.02401832
## 30 2009-01-10     Z -0.82861047
</pre>


<p><a name="separate"></a></p>
<h2>separate()</h2>
<h3>Назначение</h3>
<p>Разбивает переменную на несколько</p>
<h3>Использование</h3>
<pre class="code literal-block"><span></span>separate(data, col, into, sep = "[^[:alnum:]]+", remove = TRUE,
         convert = FALSE, extra = "error", ...)
</pre>


<h3>Аргументы</h3>
<ul>
<li>
<code>data</code> - оригинальный <code>data.frame</code>
</li>
<li>
<code>col</code> - имя переменной для разбивки</li>
<li>
<code>into</code> - имена новых переменных</li>
<li>
<code>sep</code> - разделитель, если <code>character</code> - воспринимается как регулярное выражение, по-умолчанию - последовательность не цифро-буквенных знаков, если <code>numeric</code> - воспринимается как позиция для разделения</li>
<li>
<code>remove</code> - если <code>TRUE</code> - удаляет <code>col</code> из результирующего <code>data.frame</code>
</li>
<li>
<code>convert</code> - если <code>TRUE</code> - применяет <code>type.convert</code> c <code>as.is = TRUE</code> к новым переменным</li>
<li>
<code>extra</code> - если <code>sep</code> - <code>character</code>, то аргумент задает реакцию на превышение допустимого числа новых переменных (<code>into</code>):<ul>
<li>
<code>error</code> - ошибка по-умолчанию</li>
<li>
<code>drop</code> - возвращает <code>length(into)</code>, отбрасывает все сверху или расширяет <code>data.frame</code>
</li>
<li>
<code>merge</code> - разделяет только <code>length(into)</code> раз</li>
</ul>
</li>
<li>
<code>...</code> - дополнительные переменные для <code>strsplit</code>
</li>
</ul>
<h3>Примеры использования</h3>
<p>Данные:</p>
<pre class="code literal-block"><span></span>df <span class="o">&lt;-</span> <span class="kt">data.frame</span><span class="p">(</span>x <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="s">"a.b"</span><span class="p">,</span> <span class="s">"a.d"</span><span class="p">,</span> <span class="s">"b.c"</span><span class="p">))</span>
df
</pre>


<pre class="code literal-block"><span></span>##     x
## 1 a.b
## 2 a.d
## 3 b.c
</pre>


<p>Разбить переменную <code>x</code> на две, разделитель - <code>.</code>:</p>
<pre class="code literal-block"><span></span>df <span class="o">%&gt;%</span> separate<span class="p">(</span>x<span class="p">,</span> <span class="kt">c</span><span class="p">(</span><span class="s">"A"</span><span class="p">,</span> <span class="s">"B"</span><span class="p">))</span>
</pre>


<pre class="code literal-block"><span></span>##   A B
## 1 a b
## 2 a d
## 3 b c
</pre>


<p>Если строки нельзя разделить на равное число переменных:</p>
<pre class="code literal-block"><span></span>df <span class="o">&lt;-</span> <span class="kt">data.frame</span><span class="p">(</span>x <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="s">"a"</span><span class="p">,</span> <span class="s">"a b"</span><span class="p">,</span> <span class="s">"a b c"</span><span class="p">))</span>
df <span class="o">%&gt;%</span> separate<span class="p">(</span>x<span class="p">,</span> <span class="kt">c</span><span class="p">(</span><span class="s">"a"</span><span class="p">,</span> <span class="s">"b"</span><span class="p">),</span> extra <span class="o">=</span> <span class="s">"merge"</span><span class="p">)</span>
</pre>


<pre class="code literal-block"><span></span>##   a    b
## 1 a &lt;NA&gt;
## 2 a    b
## 3 a  b c
</pre>


<pre class="code literal-block"><span></span>df <span class="o">%&gt;%</span> separate<span class="p">(</span>x<span class="p">,</span> <span class="kt">c</span><span class="p">(</span><span class="s">"a"</span><span class="p">,</span> <span class="s">"b"</span><span class="p">),</span> extra <span class="o">=</span> <span class="s">"drop"</span><span class="p">)</span>
</pre>


<pre class="code literal-block"><span></span>##   a    b
## 1 a &lt;NA&gt;
## 2 a    b
## 3 a    b
</pre>


<p>Данные:</p>
<pre class="code literal-block"><span></span>df <span class="o">&lt;-</span> <span class="kt">data.frame</span><span class="p">(</span>x <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="s">"x: 123"</span><span class="p">,</span> <span class="s">"y: error: 7"</span><span class="p">))</span>
df
</pre>


<pre class="code literal-block"><span></span>##             x
## 1      x: 123
## 2 y: error: 7
</pre>


<p>Разбить строки строго на две переменные по первому включению <code>sep</code>:</p>
<pre class="code literal-block"><span></span>df <span class="o">%&gt;%</span> separate<span class="p">(</span>x<span class="p">,</span> <span class="kt">c</span><span class="p">(</span><span class="s">"key"</span><span class="p">,</span> <span class="s">"value"</span><span class="p">),</span> <span class="s">": "</span><span class="p">,</span> extra <span class="o">=</span> <span class="s">"merge"</span><span class="p">)</span>
</pre>


<pre class="code literal-block"><span></span>##   key    value
## 1   x      123
## 2   y error: 7
</pre>


<p><a name="seq_range"></a></p>
<h2>seq_range()</h2>
<h3>Назначение</h3>
<p>Возвращает вектор из <code>n</code> значений <code>x</code> от минимального до максимального с равными промежутками</p>
<h3>Использование</h3>
<pre class="code literal-block"><span></span>seq_range(x, n)
</pre>


<h3>Аргументы</h3>
<ul>
<li>
<code>x</code> - <code>numeric vector</code>
</li>
<li>
<code>n</code> - число значений</li>
</ul>
<h3>Примеры использования</h3>
<p>Разобьем диапазон значений вектора <code>1:100</code>: </p>
<pre class="code literal-block"><span></span>seq_range<span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">100</span><span class="p">,</span> <span class="m">5</span><span class="p">)</span>
</pre>


<pre class="code literal-block"><span></span>## [1]   1.00  25.75  50.50  75.25 100.00
</pre>


<p><a name="spread"></a></p>
<h2>spread()</h2>
<h3>Назначение</h3>
<p>Переформатирует <code>data.frame</code> - используя в качестве имен новых переменных уровни заданной переменной <code>key</code>, а в качестве значений - соответствующие значения переменной <code>value</code>.</p>
<h3>Использование</h3>
<pre class="code literal-block"><span></span>spread(data, key, value, fill = NA, convert = FALSE, drop = TRUE)
</pre>


<h3>Аргументы</h3>
<ul>
<li>
<code>data</code> - <code>numeric vector</code>
</li>
<li>
<code>key</code> - переменная, чьи уровни станут новыми переменными</li>
<li>
<code>value</code> - переменная, соответствующими значениями которой будут заполнены новые столбцы</li>
<li>
<code>fill</code> - если для комбинации переменной <code>key</code> и других переменных нет значения - подставляет на его место указанное </li>
<li>
<code>convert</code> - если <code>TRUE</code> - применяет <code>type.convert</code> c <code>as.is = TRUE</code> к новым переменным</li>
<li>
<code>drop</code> - если <code>FALSE</code> - сохранить уровни факторов, для которых нет значений в данных, заполняя их по правилу <code>fill</code>
</li>
</ul>
<h3>Примеры использования</h3>
<p>Данные:</p>
<pre class="code literal-block"><span></span>stocks <span class="o">&lt;-</span> <span class="kt">data.frame</span><span class="p">(</span>
time <span class="o">=</span> <span class="kp">as.Date</span><span class="p">(</span><span class="s">'2009-01-01'</span><span class="p">)</span> <span class="o">+</span> <span class="m">0</span><span class="o">:</span><span class="m">9</span><span class="p">,</span>
X <span class="o">=</span> rnorm<span class="p">(</span><span class="m">10</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">1</span><span class="p">),</span>
Y <span class="o">=</span> rnorm<span class="p">(</span><span class="m">10</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">2</span><span class="p">),</span>
Z <span class="o">=</span> rnorm<span class="p">(</span><span class="m">10</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">4</span><span class="p">)</span>
<span class="p">)</span>
stocks
</pre>


<pre class="code literal-block"><span></span>##          time          X          Y          Z
## 1  2009-01-01  0.3911387  2.0635862 -6.3953715
## 2  2009-01-02  0.1203100 -1.3411346 -4.5907582
## 3  2009-01-03 -0.3916139 -0.3763128 -0.6275635
## 4  2009-01-04 -0.2890859  1.0035137 -2.9846424
## 5  2009-01-05  0.2296824  1.0974012  0.6136485
## 6  2009-01-06  0.0278537  4.9167183 -5.7563632
## 7  2009-01-07  0.7349981  0.4856101 -6.7558963
## 8  2009-01-08 -0.5096926 -0.8247462  2.5661235
## 9  2009-01-09  0.2338707 -0.5513422 -0.6923370
## 10 2009-01-10  2.3231925  0.2870178  1.7580478
</pre>


<p>Противоположность <code>gather</code>:</p>
<pre class="code literal-block"><span></span>stocksm <span class="o">&lt;-</span> stocks <span class="o">%&gt;%</span> gather<span class="p">(</span>stock<span class="p">,</span> price<span class="p">,</span> <span class="o">-</span>time<span class="p">)</span>
<span class="kp">head</span><span class="p">(</span>stocksm<span class="p">)</span>
</pre>


<pre class="code literal-block"><span></span>##         time stock      price
## 1 2009-01-01     X  0.3911387
## 2 2009-01-02     X  0.1203100
## 3 2009-01-03     X -0.3916139
## 4 2009-01-04     X -0.2890859
## 5 2009-01-05     X  0.2296824
## 6 2009-01-06     X  0.0278537
</pre>


<pre class="code literal-block"><span></span>stocksm <span class="o">%&gt;%</span> spread<span class="p">(</span>stock<span class="p">,</span> price<span class="p">)</span>
</pre>


<pre class="code literal-block"><span></span>##          time          X          Y          Z
## 1  2009-01-01  0.3911387  2.0635862 -6.3953715
## 2  2009-01-02  0.1203100 -1.3411346 -4.5907582
## 3  2009-01-03 -0.3916139 -0.3763128 -0.6275635
## 4  2009-01-04 -0.2890859  1.0035137 -2.9846424
## 5  2009-01-05  0.2296824  1.0974012  0.6136485
## 6  2009-01-06  0.0278537  4.9167183 -5.7563632
## 7  2009-01-07  0.7349981  0.4856101 -6.7558963
## 8  2009-01-08 -0.5096926 -0.8247462  2.5661235
## 9  2009-01-09  0.2338707 -0.5513422 -0.6923370
## 10 2009-01-10  2.3231925  0.2870178  1.7580478
</pre>


<p>Разбить <code>price</code> по переменной <code>time</code>:</p>
<pre class="code literal-block"><span></span>stocksm <span class="o">%&gt;%</span> spread<span class="p">(</span>time<span class="p">,</span> price<span class="p">)</span>
</pre>


<pre class="code literal-block"><span></span>##   stock 2009-01-01 2009-01-02 2009-01-03 2009-01-04 2009-01-05 2009-01-06
## 1     X  0.3911387   0.120310 -0.3916139 -0.2890859  0.2296824  0.0278537
## 2     Y  2.0635862  -1.341135 -0.3763128  1.0035137  1.0974012  4.9167183
## 3     Z -6.3953715  -4.590758 -0.6275635 -2.9846424  0.6136485 -5.7563632
##   2009-01-07 2009-01-08 2009-01-09 2009-01-10
## 1  0.7349981 -0.5096926  0.2338707  2.3231925
## 2  0.4856101 -0.8247462 -0.5513422  0.2870178
## 3 -6.7558963  2.5661235 -0.6923370  1.7580478
</pre>


<p><a name="unite"></a></p>
<h2>unite()</h2>
<h3>Назначение</h3>
<p>Объединяет переменные в одну</p>
<h3>Использование</h3>
<pre class="code literal-block"><span></span>unite(data, col, ..., sep = "_", remove = TRUE)
</pre>


<h3>Аргументы</h3>
<ul>
<li>
<code>data</code> - <code>numeric vector</code>
</li>
<li>
<code>col</code> - имя базовой переменной</li>
<li>
<code>...</code> - переменные для объединения с базовой</li>
<li>
<code>sep</code> - разделитель между значениями объединенных переменных </li>
<li>
<code>remove</code> - если <code>TRUE</code> - удаляет переменные для объединения</li>
</ul>
<h3>Примеры использования</h3>
<p>Объединяем переменные <code>vs</code> и <code>am</code> в одну:</p>
<pre class="code literal-block"><span></span>mtcars <span class="o">%&gt;%</span>
  unite_<span class="p">(</span><span class="s">"vs_am"</span><span class="p">,</span> <span class="kt">c</span><span class="p">(</span><span class="s">"vs"</span><span class="p">,</span> <span class="s">"am"</span><span class="p">))</span> <span class="o">%&gt;%</span>
  <span class="kp">head</span><span class="p">()</span>
</pre>


<pre class="code literal-block"><span></span>##                    mpg cyl disp  hp drat    wt  qsec vs_am gear carb
## Mazda RX4         21.0   6  160 110 3.90 2.620 16.46   0_1    4    4
## Mazda RX4 Wag     21.0   6  160 110 3.90 2.875 17.02   0_1    4    4
## Datsun 710        22.8   4  108  93 3.85 2.320 18.61   1_1    4    1
## Hornet 4 Drive    21.4   6  258 110 3.08 3.215 19.44   1_0    3    1
## Hornet Sportabout 18.7   8  360 175 3.15 3.440 17.02   0_0    3    2
## Valiant           18.1   6  225 105 2.76 3.460 20.22   1_0    3    1
</pre>


<p>Противоположность <code>separate</code>:</p>
<pre class="code literal-block"><span></span>mtcars <span class="o">%&gt;%</span>
  unite<span class="p">(</span>vs_am<span class="p">,</span> vs<span class="p">,</span> am<span class="p">)</span> <span class="o">%&gt;%</span>
  separate<span class="p">(</span>vs_am<span class="p">,</span> <span class="kt">c</span><span class="p">(</span><span class="s">"vs"</span><span class="p">,</span> <span class="s">"am"</span><span class="p">))</span> <span class="o">%&gt;%</span>
  <span class="kp">head</span><span class="p">()</span>
</pre>


<pre class="code literal-block"><span></span>##                    mpg cyl disp  hp drat    wt  qsec vs am gear carb
## Mazda RX4         21.0   6  160 110 3.90 2.620 16.46  0  1    4    4
## Mazda RX4 Wag     21.0   6  160 110 3.90 2.875 17.02  0  1    4    4
## Datsun 710        22.8   4  108  93 3.85 2.320 18.61  1  1    4    1
## Hornet 4 Drive    21.4   6  258 110 3.08 3.215 19.44  1  0    3    1
## Hornet Sportabout 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2
## Valiant           18.1   6  225 105 2.76 3.460 20.22  1  0    3    1
</pre>


<p><a name="unnest"></a></p>
<h2>unnest()</h2>
<h3>Назначение</h3>
<p>Разбивает переменную на большее число строк за счет раскрытия вложенных элементов</p>
<h3>Использование</h3>
<pre class="code literal-block"><span></span>unnest(data, col = NULL)
</pre>


<h3>Аргументы</h3>
<ul>
<li>
<code>data</code> - оригинальный <code>data.frame</code>
</li>
<li>
<code>col</code> - переменная, которую нужно разбить на большее число строк</li>
</ul>
<h3>Примеры использования</h3>
<p>Данные:</p>
<pre class="code literal-block"><span></span>df <span class="o">&lt;-</span> <span class="kt">data.frame</span><span class="p">(</span>
x <span class="o">=</span> <span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">,</span>
y <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="s">"a"</span><span class="p">,</span> <span class="s">"d,e,f"</span><span class="p">,</span> <span class="s">"g,h"</span><span class="p">),</span>
stringsAsFactors <span class="o">=</span> <span class="kc">FALSE</span>
<span class="p">)</span>
df
</pre>


<pre class="code literal-block"><span></span>##   x     y
## 1 1     a
## 2 2 d,e,f
## 3 3   g,h
</pre>


<p>Разбить переменную <code>y</code> на большее число строк:</p>
<pre class="code literal-block"><span></span>df <span class="o">%&gt;%</span>
  <span class="kp">transform</span><span class="p">(</span>y <span class="o">=</span> <span class="kp">strsplit</span><span class="p">(</span>y<span class="p">,</span> <span class="s">","</span><span class="p">))</span> <span class="o">%&gt;%</span>
  unnest<span class="p">(</span>y<span class="p">)</span>
</pre>


<pre class="code literal-block"><span></span>##   x y
## 1 1 a
## 2 2 d
## 3 2 e
## 4 2 f
## 5 3 g
## 6 3 h
</pre>


<p>Разобьем стандартный набор данных <code>iris</code> по виду цветка:</p>
<pre class="code literal-block"><span></span>my_list <span class="o">&lt;-</span> <span class="kp">lapply</span><span class="p">(</span><span class="kp">split</span><span class="p">(</span><span class="kp">subset</span><span class="p">(</span>iris<span class="p">,</span> select <span class="o">=</span> <span class="o">-</span>Species<span class="p">),</span>iris<span class="o">$</span>Species<span class="p">),</span>
                  <span class="s">"["</span><span class="p">,</span> <span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">,</span> <span class="p">)</span>
my_list
</pre>


<pre class="code literal-block"><span></span>## $setosa
##   Sepal.Length Sepal.Width Petal.Length Petal.Width
## 1          5.1         3.5          1.4         0.2
## 2          4.9         3.0          1.4         0.2
## 
## $versicolor
##    Sepal.Length Sepal.Width Petal.Length Petal.Width
## 51          7.0         3.2          4.7         1.4
## 52          6.4         3.2          4.5         1.5
## 
## $virginica
##     Sepal.Length Sepal.Width Petal.Length Petal.Width
## 101          6.3         3.3          6.0         2.5
## 102          5.8         2.7          5.1         1.9
</pre>


<p>Соберем список обратно в <code>data.frame</code>:</p>
<pre class="code literal-block"><span></span>unnest<span class="p">(</span>my_list<span class="p">)</span>
</pre>


<pre class="code literal-block"><span></span>## Source: local data frame [6 x 4]
## 
##   Sepal.Length Sepal.Width Petal.Length Petal.Width
## 1          5.1         3.5          1.4         0.2
## 2          4.9         3.0          1.4         0.2
## 3          7.0         3.2          4.7         1.4
## 4          6.4         3.2          4.5         1.5
## 5          6.3         3.3          6.0         2.5
## 6          5.8         2.7          5.1         1.9
</pre>


<p>Добавим потерявшуюся переменную <code>Species</code>:</p>
<pre class="code literal-block"><span></span>unnest<span class="p">(</span>my_list<span class="p">,</span> Species<span class="p">)</span>
</pre>


<pre class="code literal-block"><span></span>##      Species Sepal.Length Sepal.Width Petal.Length Petal.Width
## 1     setosa          5.1         3.5          1.4         0.2
## 2     setosa          4.9         3.0          1.4         0.2
## 3 versicolor          7.0         3.2          4.7         1.4
## 4 versicolor          6.4         3.2          4.5         1.5
## 5  virginica          6.3         3.3          6.0         2.5
## 6  virginica          5.8         2.7          5.1         1.9
</pre>
</div>
    </div>
    <aside class="postpromonav"><nav><ul class="pager hidden-print">
<li class="previous">
                <a href="../../../11/03/mosaic-plot/" rel="prev" title="Мозаичные диаграммы в ggplot2">Previous post</a>
            </li>
            <li class="next">
                <a href="../../../../2015/04/21/djangogirls-ru/" rel="next" title="Перевод руководства Djangogirls">Next post</a>
            </li>
        </ul></nav></aside></article></main><footer id="footer"><p>Contents © 2017         <a href="mailto:karateev.pavel@ya.ru">Pavel Karateev</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         </p>
            
        </footer>
</div>
    
    

        <script src="../../../../../assets/js/baguetteBox.min.js"></script><script>baguetteBox.run('a.reference', {
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});</script>
</body>
</html>
