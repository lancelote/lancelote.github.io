<!DOCTYPE html>
<html prefix="            og: http://ogp.me/ns# article: http://ogp.me/ns/article#     " vocab="http://ogp.me/ns" lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="Work hard - die Pythonic">
<meta name="viewport" content="width=device-width">
<title>Pavel Karateev</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" href="rss.xml">
<link rel="canonical" href="http://pavelkarateev.com/">
<!--[if lt IE 9]><script src="assets/js/html5shiv-printshiv.min.js"></script><![endif]--><link rel="prefetch" href="posts/2016/06/16/python-basics-and-usage/" type="text/html">
</head>
<body>
    <a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>
    <div id="container">
         
    <header id="header"><h1 id="brand"><a href="http://pavelkarateev.com/" title="Pavel Karateev" rel="home">

        <span id="blog-title">Pavel Karateev</span>
    </a></h1>

        

        
    <nav id="menu"><ul>
<li><a href="pages/about">About</a></li>
                <li><a href="https://twitter.com/Lancel0te">Twitter</a></li>
                <li><a href="archive.html">Archive</a></li>
                <li><a href="https://github.com/lancelote/lancelote.github.io">Source</a></li>
    
    
    </ul></nav></header><main id="content"><div class="postindex">
    <article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/2016/06/16/python-basics-and-usage/" class="u-url">Завершен курс "Python основы и применение"</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Pavel Karateev
            </span></p>
            <p class="dateline"><a href="posts/2016/06/16/python-basics-and-usage/" rel="bookmark"><time class="published dt-published" datetime="2016-06-15T00:00:00+03:00" title="2016-06-15 00:00">2016-06-15 00:00</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<p>Завершил курс "<a href="https://stepic.org/course/Python-%D0%BE%D1%81%D0%BD%D0%BE%D0%B2%D1%8B-%D0%B8-%D0%BF%D1%80%D0%B8%D0%BC%D0%B5%D0%BD%D0%B5%D0%BD%D0%B8%D0%B5-512">Python: основы и применение</a>"
от <a href="https://stepic.org/">Stepic.org</a>. Несмотря на название курс оказался весьма
интересным и не таким уж и базовым - полные новички в Python могут столкнуться с
проблемами. Мне очень понравилось, что были разобраны некоторые традиционно
пропускаемые вопросы (пресловутый Method Resolution Order), которые как раз очень
любят спрашивать на собеседованиях. Чуть подробнее о плюсах и минусах, а также
краткое содержание внутри.</p>
<p><img alt="center" src="images/2016/06/16/python-basics-and-usage/certificate.jpg"></p>
<h3>Содержание</h3>
<ul>
<li>Базовые принципы языка Python<ul>
<li>Модель данных: объекты</li>
<li>Функции и стек вызовов</li>
<li>Пространство имен и области видимости</li>
<li>Введение в классы</li>
<li>Наследование классов</li>
</ul>
</li>
<li>Стандартные средства языка Python<ul>
<li>Ошибки и исключения</li>
<li>Работа с кодом: импорты и модули</li>
<li>Итераторы и генераторы</li>
<li>Работа с файловой системой и файлами</li>
<li>Работа с функциями: <code>functools</code> и лямбда функции</li>
<li>Стиль программирования: pep8 и документация</li>
</ul>
</li>
<li>Применение Python: анализ текста<ul>
<li>Стандартные методы и функции для строк</li>
<li>Регулярные выражения в Python</li>
<li>Обзорно об интернете: http, html, <code>requests</code>
</li>
<li>Форматы текстовых файлов: CSV, JSON</li>
<li>API</li>
<li>XML, библиотека ElementTree, библиотека <code>lxml</code>
</li>
</ul>
</li>
</ul>
<h3>Плюсы</h3>
<ul>
<li>Затронуты важные углубленные темы (MRO, namespaces)</li>
<li>Хороший стартовый обзор стандартной библиотеки</li>
<li>Интересные практические задания по работе с файлами, сетью и API</li>
</ul>
<h3>Минусы (условные)</h3>
<ul>
<li>Короткий (всего 3 модуля)</li>
<li>Затронутые темы не объясняются подробно</li>
<li>Не подходит для полных новичков</li>
</ul>
<h3>Резюме</h3>
<p>Отличный курс для тех кто прошел базовое обучение Python и теперь не знает
куда податься. Здесь еще раз пробегутся по важным особенностям языка и дадут
несколько хороших практических заданий, чтобы вы могли прочувствовать на что
способен язык.</p>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/2016/06/15/intermediate-python/" class="u-url">Перевод книги "Intermediate Python"</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Pavel Karateev
            </span></p>
            <p class="dateline"><a href="posts/2016/06/15/intermediate-python/" rel="bookmark"><time class="published dt-published" datetime="2016-06-15T00:00:00+03:00" title="2016-06-15 00:00">2016-06-15 00:00</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<p>Не так давно я закончил перевод небольшой книги от разработчика из
Пакистана - <a href="https://twitter.com/yasoobkhalid">Yasoob Khalid</a> -
"<a href="https://github.com/lancelote/interpy-ru">Intermediate Python</a>". Не уверен как
лучше перевести <em>Intermediate</em> в данном контексте, но смысл в том что книга для
уже освоивших базовый Python программистов. Её основная идея дать читателю краткий обзор
нюансов языка, которые остаются за кадром базовых курсов/книг/руководств, ведь в
Python при всей его интуитивности и простоте есть немало сложных, специфических,
да и просто традиционных решений, как впрочем и в любом другом языке.</p>
<h3>О книге</h3>
<p>Книга представляет сборник небольших несвязанных глав, каждая из которых описывает
определенный "нюанс" языка. Главы не претендуют на полноценное описание вопроса,
а скорее просто дают читателю общее представление и пути для дальнейшего исследования.
Думаю всем начинающим, а может быть и опытным питонистам будет интересно.
Ниже приведено содержание с ссылками на главы, чтобы проще было сориентироваться
в затронутых тематиках.</p>
<h3>Содержание</h3>
<ul>
<li>Средства разработки<ul>
<li><a href="https://lancelote.gitbooks.io/intermediate-python/content/book/virtual_environment.html">Виртуальное окружение</a></li>
<li><a href="https://lancelote.gitbooks.io/intermediate-python/content/book/debugging.html">Отладка</a></li>
<li><a href="https://lancelote.gitbooks.io/intermediate-python/content/book/object_introspection.html">Анализ объекта</a></li>
</ul>
</li>
<li>Синтаксис<ul>
<li><a href="https://lancelote.gitbooks.io/intermediate-python/content/book/exceptions.html">Исключения</a></li>
<li><a href="https://lancelote.gitbooks.io/intermediate-python/content/book/for_-_else.html">for - else</a></li>
<li><a href="https://lancelote.gitbooks.io/intermediate-python/content/book/ternary_operators.html">Тернарные операторы</a></li>
<li><a href="https://lancelote.gitbooks.io/intermediate-python/content/book/global_&amp;_return.html">global и return</a></li>
<li><a href="https://lancelote.gitbooks.io/intermediate-python/content/book/open_function.html">Функция open</a></li>
<li><a href="https://lancelote.gitbooks.io/intermediate-python/content/book/args_and_kwargs.html">*args и **kwargs</a></li>
<li><a href="https://lancelote.gitbooks.io/intermediate-python/content/book/context_managers.html">Менеджеры контекста</a></li>
</ul>
</li>
<li>Функциональное программирование<ul>
<li><a href="https://lancelote.gitbooks.io/intermediate-python/content/book/enumerate.html">enumerate</a></li>
<li><a href="https://lancelote.gitbooks.io/intermediate-python/content/book/lambdas.html">Анонимные функции</a></li>
<li><a href="https://lancelote.gitbooks.io/intermediate-python/content/book/set_-_data_structure.html">Структура данных set</a></li>
<li><a href="https://lancelote.gitbooks.io/intermediate-python/content/book/map_filter.html">map и filter</a></li>
<li><a href="https://lancelote.gitbooks.io/intermediate-python/content/book/comprehensions.html">Абстракция списков</a></li>
</ul>
</li>
<li>Структуры данных<ul>
<li><a href="https://lancelote.gitbooks.io/intermediate-python/content/book/generators.html">Генераторы</a></li>
<li><a href="https://lancelote.gitbooks.io/intermediate-python/content/book/coroutines.html">Корутины</a></li>
</ul>
</li>
<li>Типы данных<ul>
<li><a href="https://lancelote.gitbooks.io/intermediate-python/content/book/collections.html">collections</a></li>
<li><a href="https://lancelote.gitbooks.io/intermediate-python/content/book/mutation.html">Изменяемость</a></li>
<li><a href="https://lancelote.gitbooks.io/intermediate-python/content/book/__slots__magic.html">Магия __slots__</a></li>
</ul>
</li>
<li>Декораторы<ul>
<li><a href="https://lancelote.gitbooks.io/intermediate-python/content/book/decorators.html">Что такое декоратор?</a></li>
<li><a href="https://lancelote.gitbooks.io/intermediate-python/content/book/function_caching.html">Кэширование функций</a></li>
</ul>
</li>
<li>Разное<ul>
<li><a href="https://lancelote.gitbooks.io/intermediate-python/content/book/one_liners.html">Однострочники</a></li>
<li><a href="https://lancelote.gitbooks.io/intermediate-python/content/book/python_c_extension.html">Python C расширения</a></li>
<li><a href="https://lancelote.gitbooks.io/intermediate-python/content/book/targeting_python_2_3.html">Разработка под Python 2+3</a></li>
</ul>
</li>
</ul>
<p><em>Разбивка на части условна</em></p>
<h3>Ссылки</h3>
<p>Книга:</p>
<ul>
<li><a href="https://lancelote.gitbooks.io/intermediate-python/content/">Онлайн версия на gitbook</a></li>
<li><a href="https://www.gitbook.com/book/lancelote/intermediate-python/details">Скачать с gitbook (pdf, mobi, epub)</a></li>
<li><a href="https://github.com/lancelote/interpy-ru/releases/tag/v1.0.0">Скачать с github (pdf, mobi, epub)</a></li>
</ul>
<p>Репозитории:</p>
<ul>
<li><a href="https://github.com/lancelote/interpy-ru">Репозиторий перевода</a></li>
<li><a href="https://github.com/yasoob/intermediatePython">Репозиторий оригинала (ENG)</a></li>
</ul>
<p>Фидбек:</p>
<ul>
<li><a href="https://github.com/lancelote/interpy-ru/issues/new">Отзывы/пожелания/баги</a></li>
<li><a href="https://github.com/lancelote/interpy-ru/pull/new/master">Pull requests</a></li>
</ul>
<h3>Помощь проекту</h3>
<p>Если вы хотите отблагодарить автора книги за работу, то отличным вариантом будет
купить специальную версию его книги на <a href="https://gum.co/intermediate_python">Gumroad</a>.</p>
<p>И оригинал и перевод с удовольствием принимают <a href="https://github.com/lancelote/interpy-ru/issues/new">сообщения об ошибках</a> и
<a href="https://github.com/lancelote/interpy-ru/pull/new/master">pull request'ы</a>, в том числе новые главы, исправление или изменение старых и т.п.</p>
<h3>Другие подобные ресурсы "второго шага"</h3>
<ul>
<li>
<a href="https://stepic.org/course/Python-%D0%BE%D1%81%D0%BD%D0%BE%D0%B2%D1%8B-%D0%B8-%D0%BF%D1%80%D0%B8%D0%BC%D0%B5%D0%BD%D0%B5%D0%BD%D0%B8%D0%B5-512">Python: основы и применение</a> - курс от Stepic.org, не пугайтесь названия, он
 хоть и простой, но затронуты интересные темы, которые часто опускаются (например,
 Method Resolution Order), плюс немного интересной практики</li>
<li>
<a href="https://www.amazon.com/Effective-Python-Specific-Software-Development/dp/0134034287">Effective Python - Brett Slatkin</a> - книга от инженера Google, представляет
 собой 49 "мантр" написание качественного Python кода, оценки на Amazon говорят
 сами за себя</li>
<li>
<a href="https://github.com/brennerm/PyTricks">PyTricks</a> - репозиторий с примерами
 различных темных и не очень уголков языка, представляет собой code snippets</li>
<li>...</li>
</ul>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/2016/02/18/oss-university-start/" class="u-url">First FreeCodeCamp project is complete</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Pavel Karateev
            </span></p>
            <p class="dateline"><a href="posts/2016/02/18/oss-university-start/" rel="bookmark"><time class="published dt-published" datetime="2016-02-18T00:00:00+03:00" title="2016-02-18 00:00">2016-02-18 00:00</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<p>Not long ago I have started my <a href="http://www.freecodecamp.com/lancelote">FreeCodeCamp</a>
path thanks to <a href="https://smartprogress.do/goal/162912/">smartprogress.do</a> to
gain a better knowledge of frontend technology stack. I was somewhat sceptical
that time about my capabilities in the area ("I am not a designer - I'm an
engineer") and I did no like front end altogether. All that billions of
JS-related technologies and HTML with CSS on top of the cake, gosh! Time has passed
and I have catch myself today enjoining of frontend development. So, what is
happened to me? Not much in reality.</p>
<p><img alt="center" src="images/2016/02/18/ayn-rand-tribute/smartprogress.jpg"></p>
<h3>Smartprogress</h3>
<p>First of all, thanks Lord I found this website. It has pretty ugly layout, bad
translation and I really hate when something is broken there again, but it
value lies in different place. It has opened for me the importance of
collaboration with passionate people and how it can greatly motivate you
toward your goals. I do not call you to start using smartprogress but I call
you to start collaborate with people in any way you will find appropriate. It will
have dramatic effect on you live - trust me, solitude seems not be the best
choice in IT.</p>
<h3>FreeCodeCamp</h3>
<p>Thanks to my new friends at smartprogress I have fond this gorgeous online learning
platform. It's fully free and has a great foundation idea ever - 'PRACTICE'! 
Yeap, "practise makes perfect", simple but powerful idea we forgot too
frequently. To gain maximum from this opportunity I have combined it with
the new learning style I have started to practise this year - little steps every day.
Push forward every day no matter how far. Let it be just a little code change
or a new book page - push forward! Step by step I have reached first FreeCodeCamp
project.</p>
<h3>Codepen.io</h3>
<p>I was surprised of the project difficulty (that was a portfolio one).
Perhaps old me would never be able to finish it not even because
of it's complexity (in fact it is super easy) but due to my laziness or should
I say overwhelming of guides, tutorials, projects, podcasts and video typical
novice developer face every day. But I have started to work on it step by step and was
surprised how fast in fact everything starts to go. Here we have another
great platform I have started to use - <a href="http://codepen.io/">codepen.io</a>. It is simple
online front end playground. Great tools has a major impact not only on our
productivity but on our mental attitude and codepen helps me greatly - it's
really convenient and aspirational for beginner to see instantaneous effect
of his or her css tweaks. I encourage you to give this nice service a try, it's not only
an online editor but also a social platform for frontend developers +great blog
and podcast.</p>
<h3>First Project</h3>
<p>So my first project is complete now. It is ultra simple one page
<a href="http://codepen.io/lancelote/full/OMqbMx/">Ayn Rand tribute</a> and I really
enjoyed working on it. Personal Portfolio is 50% ready and I hope to complete
it soon and use here - current about page is too simple as for me.</p>
<h3>English</h3>
<p>As always please excuse my poor English skill. I invest a lot of spare time in
developing my language proficiency, but it is still not awesome enough. I would
greatly appreciate any recommendation and corrections!</p>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/2016/01/11/oss-university-start/" class="u-url">OSS University Path</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Pavel Karateev
            </span></p>
            <p class="dateline"><a href="posts/2016/01/11/oss-university-start/" rel="bookmark"><time class="published dt-published" datetime="2016-01-11T00:00:00+03:00" title="2016-01-11 00:00">2016-01-11 00:00</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<p>Sadly I have no solid background in CS. There were few CS-related courses in
the University (C++, Optimisation, math and so on), but the major part of my
expertise comes from the experience. My field knowledge is pretty broad, but it
is shallow in some places (in a lot of places) and has big holes here and there.
That is why I really hope Open Source Society University initiative will help
me build vast and complete CS "base".</p>
<p><img alt="center" src="images/2016/01/11/oss-university/ossu-logo.png"></p>
<h2>What is Open Source Society University?</h2>
<p><a href="https://github.com/open-source-society/computer-science" title="Open Source Society University">Open Source Society University</a>:</p>
<pre class="code literal-block"><span></span>This is a solid path for those of you who want to complete a Computer
Science course on your own time, for free, with courses from the best
universities in the World.

In our curriculum, we gave preference to MOOC (Massive Open Online Course)
style courses because those courses were created with our style of
learning in mind.
</pre>


<p>So we have some kind of well known JavaScript Path, but in the broad field
of Computer Science. There is a long list of MOOCs, one also should build
projects after each course.</p>
<h2>My Plans</h2>
<p>I consider January as a good start point for OSS University path. So, let's do
it. I'll track my progress and post status here. The first course is basic -
<a href="https://www.edx.org/course/introduction-computer-science-harvardx-cs50x#!" title="Introduction to Computer Science">Introduction to Computer Science</a> by edX, nevertheless I does not plan to
skip it. With me patience = )</p>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/2015/12/04/taskbuster-tutorial/" class="u-url">Taskbuster Tutorial</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Pavel Karateev
            </span></p>
            <p class="dateline"><a href="posts/2015/12/04/taskbuster-tutorial/" rel="bookmark"><time class="published dt-published" datetime="2015-12-04T00:00:00+03:00" title="2015-12-04 00:00">2015-12-04 00:00</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<p>From time to time I check out my <em>ToRead</em> folder (believe me it is infinite),
and guess what I found there a week ago - BEST DJANGO TUTORIAL I EVER READ!
Just go ahead and look at this beauty: <a href="http://www.marinamele.com/taskbuster-django-tutorial">Taskbuster Django Tutorial by Marina Mele</a>.
Table of content is available inside the <em>Read more...</em>. So why am I so excited
about it? Because <a href="https://twitter.com/Marina_Mele">Marina</a> used a rare way to
approach tutorial creation. She did not start with <em>no one used in real world</em>
practises like many authors do, but goes straight to the best Django
development patterns. She even wrote about environment variables!</p>
<p><img alt="center" src="images/2015/12/04/taskbuster/taskbuster.jpg"></p>
<h3>Table of Content</h3>
<ul>
<li><a href="http://www.marinamele.com/taskbuster-django-tutorial/taskbuster-working-environment-and-start-django-project">Part I – Working environment and start a Django Project</a></li>
<li><a href="http://www.marinamele.com/taskbuster-django-tutorial/settings-different-environments-version-control">Part II – Settings files and Version control</a></li>
<li><a href="http://www.marinamele.com/taskbuster-django-tutorial/create-home-page-with-tdd-staticfiles-templates-settings">Part III – Create a Home Page with TDD, Staticfiles and Templates settings</a></li>
<li><a href="http://www.marinamele.com/taskbuster-django-tutorial/template-inheritance-website-files-and-testing-with-coverage">Part IV – Template Inheritance, Website files and Testing with coverage</a></li>
<li><a href="http://www.marinamele.com/taskbuster-django-tutorial/internationalization-localization-languages-time-zones">Part V – Internationalization and Localization. Languages and Time zones</a></li>
<li><a href="http://www.marinamele.com/taskbuster-django-tutorial/documenting-project-github-readthedocs">Part VI – Documenting the TaskBuster Django Boilerplate</a></li>
<li><a href="http://www.marinamele.com/taskbuster-django-tutorial/install-and-configure-posgresql-for-django">Part VII.a – Install and Configure PostgreSQL</a></li>
<li><a href="http://www.marinamele.com/taskbuster-django-tutorial/install-and-configure-mysql-for-django">Part VII.b – Install and Configure MySQL</a></li>
<li><a href="http://www.marinamele.com/user-authentication-with-google-using-django-allauth">Part VIII – User Authentication with a Google Account using Django Allauth</a></li>
<li><a href="http://www.marinamele.com/user-authentication-with-twitter-using-django-allauth">Part VIII.b – User Authentication with Twitter using Django Allauth</a></li>
<li><a href="http://www.marinamele.com/taskbuster-django-tutorial/model-creation-onetoone-relationship-signals-django-admin">Part IX – Model creation, OneToOne relations, signals, Django Admin</a></li>
<li><a href="http://www.marinamele.com/taskbuster-django-tutorial/model-creation-foreignkey-relationship-testing-django-admin">Part X – Model creation, ForeignKey relations, testing, Django Admin</a></li>
</ul>
<h3>Especially Interesting Topics</h3>
<p>Just few topics I want to especially mention:</p>
<ul>
<li><a href="http://www.marinamele.com/taskbuster-django-tutorial/taskbuster-working-environment-and-start-django-project">Environment variable</a></li>
<li><a href="http://www.marinamele.com/taskbuster-django-tutorial/settings-different-environments-version-control">Multiple settings files</a></li>
<li>
<a href="http://www.marinamele.com/taskbuster-django-tutorial/install-and-configure-posgresql-for-django">PostgreSQL</a> and <a href="http://www.marinamele.com/taskbuster-django-tutorial/install-and-configure-mysql-for-django">MySQL</a>
</li>
<li>Social AUTH with <a href="http://www.marinamele.com/user-authentication-with-google-using-django-allauth">Google</a> and <a href="http://www.marinamele.com/user-authentication-with-twitter-using-django-allauth">Twitter</a>
</li>
<li>TDD</li>
<li><a href="http://www.marinamele.com/taskbuster-django-tutorial/internationalization-localization-languages-time-zones">Internationalization and Localization</a></li>
</ul>
<h3>To be continued...</h3>
<p>So the tutorial is not finished yet. And maybe it will not be finished,
but it is already an excellent source of knowledge for any Junior (Middle?)
Django developer and I really encourage you to check it out if you interesting
in the Wev Development, Python and Django of course.</p>
<h3>Should I start my Django/Python way there?</h3>
<p>No, perhaps no. <a href="http://tutorial.djangogirls.org/">DjangoGirls tutorial</a> is more suitable for complete
beginners. Taskbuster is a good next step, when you already know some basics.</p>
<h3>I know a better tutorial</h3>
<p>Please go ahead and share it in the comments section below!</p>
<h2>Grammar</h2>
<p>I want to switch the blog language from Russian to English and this article
will be the first English one here. Though I'm not an English native speaker
so I bet there're a lot (A LOT) of errors/typos and so on. I beg your pardon!
I do my best to improve my English knowledge and practise makes perfect. I
would definitely appreciate any corrections and suggestions!</p>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/2015/05/01/web-app-arch/" class="u-url">Онлайн курс Web Application Architectures</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Pavel Karateev
            </span></p>
            <p class="dateline"><a href="posts/2015/05/01/web-app-arch/" rel="bookmark"><time class="published dt-published" datetime="2015-05-01T00:00:00+03:00" title="2015-05-01 00:00">2015-05-01 00:00</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<p>Только что завершил последнее задание курса <a href="https://class.coursera.org/webapplications-003">Web Application Architectures</a> от университета Нью-Мексико и Coursera. Потрачено ли время зря?</p>
<h3>Что объясняют и насколько сложен курс?</h3>
<p>Курс оказался довольно простым в плане прохождения (зачем нужны задания на программирование, где буква в букву предлагается вбивать код из последней лекции соответствующего модуля я так и не понял), однако в плане понимания все обстоит несколько иначе. В лекциях затрагивается большое количество тем, начиная с Ruby on Rails и самого языка Ruby, а также непосредственно архитектуры веб приложений + HTML, CSS, JS, Ajax. Даже грешный git засветился. Объем при этом всего 6 недель, в результате чего получаем абсолютно неубедительные попытки что-то объяснить.</p>
<h3>Тематичный плач</h3>
<p>Думаю, что в погоне за низким порогом вхождения на курс ("вам нужно иметь только  руки и монитор, чтобы принять участие!") авторы многих новых онлайн курсов приносят в жертву содержание, которое по сути - единственно, что принципиально важно. Как итог, попытка построить в голове у студента титаническую конструкцию из стека технологий приводит к её обрушению, под развалинами которой погребается юный неофит. Существует 1000 и одно отличное руководство по HTML и git, зачем плодить некачественные дубликаты?</p>
<h3>Так стоит ли браться?</h3>
<p>Если хотите немного расширить кругозор в области проектирования веб-приложений и есть излишек свободного времени, который, дырку над ним в небе, некуда пристроить совершенно. А такое вообще бывает? Вот то-то и оно.</p>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/2015/04/21/djangogirls-ru/" class="u-url">Перевод руководства Djangogirls</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Pavel Karateev
            </span></p>
            <p class="dateline"><a href="posts/2015/04/21/djangogirls-ru/" rel="bookmark"><time class="published dt-published" datetime="2015-04-21T00:00:00+03:00" title="2015-04-21 00:00">2015-04-21 00:00</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<p><strong>Djangogirls</strong> - это некоммерческая организация, занимающаяся поддержкой программирования и конкретно Django в женской среде. Основная работа заключается в проведении семинаров по всему миру для начинающих, на которых леди могут под чутким руководством менторов собрать свой собственный блог на Django и пройти другие этапы знакомства с фреймворком, Python, git и другими релевантными технологиями.</p>
<p><img alt="center" src="images/2015/04/21/djangogirls-ru/djangogirls_logo.png"></p>
<p>Материал семинаров скомпилирован в <a href="http://tutorial.djangogirls.org/en/index.html">руководстве по Django</a> и переводится на волонтерской основе на различные языки при помощи платформы <a href="https://crowdin.com/project/django-girls-tutorial">crowdin.com</a></p>
<p>Я наткнулся на проект случайно через, уже упомянутый, crowdin.com, вбив в поиск Python. Учебник действительно стоящий (хотя без ментора или багажа знаний за плечами тяжеловат для восприятия), я быстро его пробежал и загорелся идей добить русскоязычный перевод, на тот момент он был в стадии 5-10%. Сейчас задача, в основном, закончена. На плашке красуется 100%, однако предстоит еще длительная вычитка и правки. Надеюсь, что перевод выйдет в релиз на сайте учебника в этом месяце.</p>
<p>Если у вас есть желание помочь с переводом или содержанием учебника, пожалуйста, не стесняйтесь врываться на <a href="https://crowdin.com/project/django-girls-tutorial">crowdin.com</a> или в <a href="https://github.com/DjangoGirls/tutorial/issues/new">issue tracker</a> репозитория руководства на Github! Я также всегда открыт для приема замечаний о переводе.</p>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/2014/12/13/tidyr-how-to/" class="u-url">tidyr HOW-TO</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Pavel Karateev
            </span></p>
            <p class="dateline"><a href="posts/2014/12/13/tidyr-how-to/" rel="bookmark"><time class="published dt-published" datetime="2014-12-13T00:00:00+03:00" title="2014-12-13 00:00">2014-12-13 00:00</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<p>Шпаргалка возможностей пакета <tt class="docutils literal">tidyr</tt>.</p>
<div class="section" id="id1">
<h2>Содержание</h2>
<ol class="arabic simple">
<li><a class="reference internal" href="posts/2014/12/13/tidyr-how-to/#expand">expand()</a></li>
<li><a class="reference internal" href="posts/2014/12/13/tidyr-how-to/#extract">extract()</a></li>
<li><a class="reference internal" href="posts/2014/12/13/tidyr-how-to/#extract-numeric">extract_numeric()</a></li>
<li><a class="reference internal" href="posts/2014/12/13/tidyr-how-to/#gather">gather()</a></li>
<li><a class="reference internal" href="posts/2014/12/13/tidyr-how-to/#separate">separate()</a></li>
<li><a class="reference internal" href="posts/2014/12/13/tidyr-how-to/#seq-range">seq_range()</a></li>
<li><a class="reference internal" href="posts/2014/12/13/tidyr-how-to/#spread">spread()</a></li>
<li><a class="reference internal" href="posts/2014/12/13/tidyr-how-to/#unite">unite()</a></li>
<li><a class="reference internal" href="posts/2014/12/13/tidyr-how-to/#unnest">unnest()</a></li>
</ol>
</div>
<div class="section" id="id2">
<h2>Общее</h2>
<p>Пакет <tt class="docutils literal">tidyr</tt> за авторством Hadley Wickham'а предназначен для первичной обработки сырых данных, в частности - изменения их структуры. Для начала нам потребуются сам <tt class="docutils literal">tidyr</tt>, а также <tt class="docutils literal">dplyr</tt>:</p>
<pre class="code r"><a name="rest_code_87c464fecae540e8a815e24f272a63ed-1"></a><span class="kn">library</span><span class="p">(</span>tidyr<span class="p">)</span>
<a name="rest_code_87c464fecae540e8a815e24f272a63ed-2"></a><span class="kn">library</span><span class="p">(</span>dplyr<span class="p">)</span>
</pre>
</div>
<div class="section" id="expand">
<h2>expand()</h2>
<div class="section" id="id3">
<h3>Назначение</h3>
<p>Создает <tt class="docutils literal">data.frame</tt> включающий все комбинации заданных переменных без перестановок</p>
</div>
<div class="section" id="id4">
<h3>Использование</h3>
<p><tt class="docutils literal">expand(data, <span class="pre">...)</span></tt></p>
</div>
<div class="section" id="id5">
<h3>Аргументы</h3>
<ul class="simple">
<li>
<tt class="docutils literal">data</tt> - оригинальный <tt class="docutils literal">data.frame</tt>
</li>
<li>
<tt class="docutils literal">...</tt> - имена переменных для комбинации (допустимы выражения вместо непосредственно имен)</li>
</ul>
</div>
<div class="section" id="id6">
<h3>Примеры использования</h3>
<p>Данные:</p>
<pre class="code r"><a name="rest_code_d3113e28f41e4bacaf5c58bd51368571-1"></a>df <span class="o">&lt;-</span> <span class="kt">data.frame</span><span class="p">(</span>a <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">5</span><span class="p">),</span> b <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="m">3</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">3</span><span class="p">),</span> <span class="kt">c</span> <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">))</span>
<a name="rest_code_d3113e28f41e4bacaf5c58bd51368571-2"></a>df
</pre>
<pre class="code text"><a name="rest_code_aec396b1247643f8a977ce1145e68289-1"></a>##   a b c
<a name="rest_code_aec396b1247643f8a977ce1145e68289-2"></a>## 1 1 3 1
<a name="rest_code_aec396b1247643f8a977ce1145e68289-3"></a>## 2 2 5 2
<a name="rest_code_aec396b1247643f8a977ce1145e68289-4"></a>## 3 5 3 3
</pre>
<p>Все комбинации переменных <tt class="docutils literal">vs</tt> и <tt class="docutils literal">cyl</tt>:</p>
<pre class="code r"><a name="rest_code_a63e010df25e4843af8a1c6cc8de84c3-1"></a>expand<span class="p">(</span>mtcars<span class="p">,</span> vs<span class="p">,</span> cyl<span class="p">)</span>
</pre>
<pre class="code text"><a name="rest_code_bb2efd2f8d8641b6a8c839891fd3bee4-1"></a>##   vs cyl
<a name="rest_code_bb2efd2f8d8641b6a8c839891fd3bee4-2"></a>## 1  0   4
<a name="rest_code_bb2efd2f8d8641b6a8c839891fd3bee4-3"></a>## 2  0   6
<a name="rest_code_bb2efd2f8d8641b6a8c839891fd3bee4-4"></a>## 3  0   8
<a name="rest_code_bb2efd2f8d8641b6a8c839891fd3bee4-5"></a>## 4  1   4
<a name="rest_code_bb2efd2f8d8641b6a8c839891fd3bee4-6"></a>## 5  1   6
<a name="rest_code_bb2efd2f8d8641b6a8c839891fd3bee4-7"></a>## 6  1   8
</pre>
<p>Все комбинации переменных <tt class="docutils literal">cyl</tt> и <tt class="docutils literal">mpg</tt>, последняя при этом принимает только минимальное или максимальное значение:</p>
<pre class="code r"><a name="rest_code_602547f84e474d34a45b9918321cfda6-1"></a>expand<span class="p">(</span>mtcars<span class="p">,</span> cyl<span class="p">,</span> mpg <span class="o">=</span> seq_range<span class="p">(</span>mpg<span class="p">,</span> <span class="m">2</span><span class="p">))</span>
</pre>
<pre class="code text"><a name="rest_code_26d2fec2458e46c1b4d9087fa35d8882-1"></a>##   cyl  mpg
<a name="rest_code_26d2fec2458e46c1b4d9087fa35d8882-2"></a>## 1   4 10.4
<a name="rest_code_26d2fec2458e46c1b4d9087fa35d8882-3"></a>## 2   4 33.9
<a name="rest_code_26d2fec2458e46c1b4d9087fa35d8882-4"></a>## 3   6 10.4
<a name="rest_code_26d2fec2458e46c1b4d9087fa35d8882-5"></a>## 4   6 33.9
<a name="rest_code_26d2fec2458e46c1b4d9087fa35d8882-6"></a>## 5   8 10.4
<a name="rest_code_26d2fec2458e46c1b4d9087fa35d8882-7"></a>## 6   8 33.9
</pre>
<p>Все комбинации переменных <tt class="docutils literal">cyl</tt> и <tt class="docutils literal">mpg</tt>, последняя при этом принимает значения из разбитого на 5 равных частей диапазона:</p>
<pre class="code r"><a name="rest_code_d64a6688beb540e1adeb8778c63623ab-1"></a>expand<span class="p">(</span>mtcars<span class="p">,</span> cyl<span class="p">,</span> mpg <span class="o">=</span> seq_range<span class="p">(</span>mpg<span class="p">,</span> <span class="m">5</span><span class="p">))</span>
</pre>
<pre class="code text"><a name="rest_code_f5e1b7765d2f461daa45137bb98a0341-1"></a>##    cyl    mpg
<a name="rest_code_f5e1b7765d2f461daa45137bb98a0341-2"></a>## 1    4 10.400
<a name="rest_code_f5e1b7765d2f461daa45137bb98a0341-3"></a>## 2    4 16.275
<a name="rest_code_f5e1b7765d2f461daa45137bb98a0341-4"></a>## 3    4 22.150
<a name="rest_code_f5e1b7765d2f461daa45137bb98a0341-5"></a>## 4    4 28.025
<a name="rest_code_f5e1b7765d2f461daa45137bb98a0341-6"></a>## 5    4 33.900
<a name="rest_code_f5e1b7765d2f461daa45137bb98a0341-7"></a>## 6    6 10.400
<a name="rest_code_f5e1b7765d2f461daa45137bb98a0341-8"></a>## 7    6 16.275
<a name="rest_code_f5e1b7765d2f461daa45137bb98a0341-9"></a>## 8    6 22.150
<a name="rest_code_f5e1b7765d2f461daa45137bb98a0341-10"></a>## 9    6 28.025
<a name="rest_code_f5e1b7765d2f461daa45137bb98a0341-11"></a>## 10   6 33.900
<a name="rest_code_f5e1b7765d2f461daa45137bb98a0341-12"></a>## 11   8 10.400
<a name="rest_code_f5e1b7765d2f461daa45137bb98a0341-13"></a>## 12   8 16.275
<a name="rest_code_f5e1b7765d2f461daa45137bb98a0341-14"></a>## 13   8 22.150
<a name="rest_code_f5e1b7765d2f461daa45137bb98a0341-15"></a>## 14   8 28.025
<a name="rest_code_f5e1b7765d2f461daa45137bb98a0341-16"></a>## 15   8 33.900
</pre>
<p>Все комбинации переменных <tt class="docutils literal">a</tt>, <tt class="docutils literal">b</tt> и <tt class="docutils literal">c</tt>:</p>
<pre class="code r"><a name="rest_code_4dc286c2ae204855a40e89d22d959814-1"></a>expand<span class="p">(</span>df<span class="p">)</span>
</pre>
<pre class="code text"><a name="rest_code_db0fe22092044431999ecb9fe7008026-1"></a>##    a b c
<a name="rest_code_db0fe22092044431999ecb9fe7008026-2"></a>## 1  1 3 1
<a name="rest_code_db0fe22092044431999ecb9fe7008026-3"></a>## 2  1 3 2
<a name="rest_code_db0fe22092044431999ecb9fe7008026-4"></a>## 3  1 3 3
<a name="rest_code_db0fe22092044431999ecb9fe7008026-5"></a>## 4  1 5 1
<a name="rest_code_db0fe22092044431999ecb9fe7008026-6"></a>## 5  1 5 2
<a name="rest_code_db0fe22092044431999ecb9fe7008026-7"></a>## 6  1 5 3
<a name="rest_code_db0fe22092044431999ecb9fe7008026-8"></a>## 7  2 3 1
<a name="rest_code_db0fe22092044431999ecb9fe7008026-9"></a>## 8  2 3 2
<a name="rest_code_db0fe22092044431999ecb9fe7008026-10"></a>## 9  2 3 3
<a name="rest_code_db0fe22092044431999ecb9fe7008026-11"></a>## 10 2 5 1
<a name="rest_code_db0fe22092044431999ecb9fe7008026-12"></a>## 11 2 5 2
<a name="rest_code_db0fe22092044431999ecb9fe7008026-13"></a>## 12 2 5 3
<a name="rest_code_db0fe22092044431999ecb9fe7008026-14"></a>## 13 5 3 1
<a name="rest_code_db0fe22092044431999ecb9fe7008026-15"></a>## 14 5 3 2
<a name="rest_code_db0fe22092044431999ecb9fe7008026-16"></a>## 15 5 3 3
<a name="rest_code_db0fe22092044431999ecb9fe7008026-17"></a>## 16 5 5 1
<a name="rest_code_db0fe22092044431999ecb9fe7008026-18"></a>## 17 5 5 2
<a name="rest_code_db0fe22092044431999ecb9fe7008026-19"></a>## 18 5 5 3
</pre>
<p>Все комбинации переменных <tt class="docutils literal">a</tt> и <tt class="docutils literal">b</tt>:</p>
<pre class="code r"><a name="rest_code_52d119fbfa6049649910da52084c43ca-1"></a>expand<span class="p">(</span>df<span class="p">,</span> a<span class="p">,</span> b<span class="p">)</span>
</pre>
<pre class="code text"><a name="rest_code_32682f3b8e134533a1b907ce666ee82b-1"></a>##   a b
<a name="rest_code_32682f3b8e134533a1b907ce666ee82b-2"></a>## 1 1 3
<a name="rest_code_32682f3b8e134533a1b907ce666ee82b-3"></a>## 2 1 5
<a name="rest_code_32682f3b8e134533a1b907ce666ee82b-4"></a>## 3 2 3
<a name="rest_code_32682f3b8e134533a1b907ce666ee82b-5"></a>## 4 2 5
<a name="rest_code_32682f3b8e134533a1b907ce666ee82b-6"></a>## 5 5 3
<a name="rest_code_32682f3b8e134533a1b907ce666ee82b-7"></a>## 6 5 5
</pre>
<p>Все комбинации переменных <tt class="docutils literal">a</tt> и <tt class="docutils literal">c</tt>:</p>
<pre class="code r"><a name="rest_code_03be244667d84f9f9554296258a6f904-1"></a>expand<span class="p">(</span>df<span class="p">,</span> a<span class="p">,</span> <span class="kt">c</span><span class="p">)</span>
</pre>
<pre class="code text"><a name="rest_code_54698a3e368c4243a4632409780bebdd-1"></a>##   a c
<a name="rest_code_54698a3e368c4243a4632409780bebdd-2"></a>## 1 1 1
<a name="rest_code_54698a3e368c4243a4632409780bebdd-3"></a>## 2 1 2
<a name="rest_code_54698a3e368c4243a4632409780bebdd-4"></a>## 3 1 3
<a name="rest_code_54698a3e368c4243a4632409780bebdd-5"></a>## 4 2 1
<a name="rest_code_54698a3e368c4243a4632409780bebdd-6"></a>## 5 2 2
<a name="rest_code_54698a3e368c4243a4632409780bebdd-7"></a>## 6 2 3
<a name="rest_code_54698a3e368c4243a4632409780bebdd-8"></a>## 7 5 1
<a name="rest_code_54698a3e368c4243a4632409780bebdd-9"></a>## 8 5 2
<a name="rest_code_54698a3e368c4243a4632409780bebdd-10"></a>## 9 5 3
</pre>
<p>Все комбинации переменных <tt class="docutils literal">b</tt> и <tt class="docutils literal">c</tt>:</p>
<pre class="code r"><a name="rest_code_77f15e639d254539b26089b4f78deffc-1"></a>expand<span class="p">(</span>df<span class="p">,</span> b<span class="p">,</span> <span class="kt">c</span><span class="p">)</span>
</pre>
<pre class="code text"><a name="rest_code_afaff63f28fd4e01a15becde4357fff1-1"></a>##   b c
<a name="rest_code_afaff63f28fd4e01a15becde4357fff1-2"></a>## 1 3 1
<a name="rest_code_afaff63f28fd4e01a15becde4357fff1-3"></a>## 2 3 2
<a name="rest_code_afaff63f28fd4e01a15becde4357fff1-4"></a>## 3 3 3
<a name="rest_code_afaff63f28fd4e01a15becde4357fff1-5"></a>## 4 5 1
<a name="rest_code_afaff63f28fd4e01a15becde4357fff1-6"></a>## 5 5 2
<a name="rest_code_afaff63f28fd4e01a15becde4357fff1-7"></a>## 6 5 3
</pre>
</div>
</div>
<div class="section" id="extract">
<h2>extract()</h2>
<div class="section" id="id7">
<h3>Назначение</h3>
<p>Применяет регулярное выражение к переменной и создает одну или несколько новых на основе результата</p>
</div>
<div class="section" id="id8">
<h3>Использование</h3>
<pre class="code text"><a name="rest_code_368ce5ccfe484289ae60824ac0507f2f-1"></a>extract(data, col, into, regex = "([[:alnum:]]+)", remove = TRUE,
<a name="rest_code_368ce5ccfe484289ae60824ac0507f2f-2"></a>        convert = FALSE, ...)
</pre>
</div>
<div class="section" id="id9">
<h3>Аргументы</h3>
<ul class="simple">
<li>
<tt class="docutils literal">data</tt> - оригинальный <tt class="docutils literal">data.frame</tt>
</li>
<li>
<tt class="docutils literal">col</tt> - имя переменной</li>
<li>
<tt class="docutils literal">into</tt> - имена новых переменных</li>
<li>
<tt class="docutils literal">regex</tt> - регулярное выражение для поиска требуемых данных</li>
<li>
<tt class="docutils literal">remove</tt> - если <tt class="docutils literal">TRUE</tt> - удаляет <tt class="docutils literal">col</tt> из результирующего <tt class="docutils literal">data.frame</tt>
</li>
<li>
<tt class="docutils literal">convert</tt> - если <tt class="docutils literal">TRUE</tt> - применяет <tt class="docutils literal">type.convert</tt> c <tt class="docutils literal">as.is = TRUE</tt> к новым переменным</li>
<li>
<tt class="docutils literal">...</tt> - дополнительные аргументы для <tt class="docutils literal">regexec</tt>
</li>
</ul>
</div>
<div class="section" id="id10">
<h3>Примеры использования</h3>
<p>Данные:</p>
<pre class="code r"><a name="rest_code_6bbb2c1a23994b3284c87db889996f50-1"></a>df <span class="o">&lt;-</span> <span class="kt">data.frame</span><span class="p">(</span>x <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="s">"a.b"</span><span class="p">,</span> <span class="s">"a.d"</span><span class="p">,</span> <span class="s">"b.c"</span><span class="p">))</span>
<a name="rest_code_6bbb2c1a23994b3284c87db889996f50-2"></a>df
</pre>
<pre class="code text"><a name="rest_code_f4c39f6a3a574cf59483949b5b53b50f-1"></a>##     x
<a name="rest_code_f4c39f6a3a574cf59483949b5b53b50f-2"></a>## 1 a.b
<a name="rest_code_f4c39f6a3a574cf59483949b5b53b50f-3"></a>## 2 a.d
<a name="rest_code_f4c39f6a3a574cf59483949b5b53b50f-4"></a>## 3 b.c
</pre>
<p>Извлечь из переменной <tt class="docutils literal">x</tt> первую букву:</p>
<pre class="code r"><a name="rest_code_0532b63f12bf455a88a61455a3b4524c-1"></a>df <span class="o">%&gt;%</span> extract<span class="p">(</span>x<span class="p">,</span> <span class="s">"A"</span><span class="p">)</span>
</pre>
<pre class="code text"><a name="rest_code_cb127c82838141b985d21c7541405bee-1"></a>##   A
<a name="rest_code_cb127c82838141b985d21c7541405bee-2"></a>## 1 a
<a name="rest_code_cb127c82838141b985d21c7541405bee-3"></a>## 2 a
<a name="rest_code_cb127c82838141b985d21c7541405bee-4"></a>## 3 b
</pre>
<p>Разбить переменную <tt class="docutils literal">x</tt>:</p>
<pre class="code r"><a name="rest_code_ac755a2f4d8b48bb83369ecd87c3c7bc-1"></a>df <span class="o">%&gt;%</span> extract<span class="p">(</span>x<span class="p">,</span> <span class="kt">c</span><span class="p">(</span><span class="s">"A"</span><span class="p">,</span> <span class="s">"B"</span><span class="p">),</span> <span class="s">"([[:alnum:]]+)\\.([[:alnum:]]+)"</span><span class="p">)</span>
</pre>
<pre class="code text"><a name="rest_code_90395a19849747e6b6a8abe306c275be-1"></a>##   A B
<a name="rest_code_90395a19849747e6b6a8abe306c275be-2"></a>## 1 a b
<a name="rest_code_90395a19849747e6b6a8abe306c275be-3"></a>## 2 a d
<a name="rest_code_90395a19849747e6b6a8abe306c275be-4"></a>## 3 b c
</pre>
</div>
</div>
<div class="section" id="extract-numeric">
<h2>extract_numeric()</h2>
<div class="section" id="id11">
<h3>Назначение</h3>
<p>Используя регулярное выражение удаляет все нецифровые знаки из строки и трансформирует результат в число</p>
</div>
<div class="section" id="id12">
<h3>Использование</h3>
<pre class="code text"><a name="rest_code_adf2b66a84bd4ed79fceb5c2d44ce0b8-1"></a>extract_numeric(x)
</pre>
</div>
<div class="section" id="id13">
<h3>Аргументы</h3>
<ul class="simple">
<li>
<tt class="docutils literal">x</tt> - <tt class="docutils literal">character vector</tt> или <tt class="docutils literal">factor</tt>
</li>
</ul>
</div>
<div class="section" id="id14">
<h3>Примеры использования</h3>
<pre class="code r"><a name="rest_code_c1398565d2d14c4484f4b886a03da573-1"></a>extract_numeric<span class="p">(</span><span class="s">"$1,200.34"</span><span class="p">)</span>
</pre>
<pre class="code text"><a name="rest_code_b7215b15408949d281642d806af461b2-1"></a>## [1] 1200.34
</pre>
<pre class="code r"><a name="rest_code_00864292b24a49cba96f25a9b78ed06f-1"></a>extract_numeric<span class="p">(</span><span class="s">"-2%"</span><span class="p">)</span>
</pre>
<pre class="code text"><a name="rest_code_3e14c221fb524c2397f8ec298673d970-1"></a>## [1] -2
</pre>
<p>Может некорректно работать со строками, которые точно не являются цифровыми данными:</p>
<pre class="code r"><a name="rest_code_e191989336e747ee87bbf0178f9dd4ac-1"></a>extract_numeric<span class="p">(</span><span class="s">"-2-2"</span><span class="p">)</span>
</pre>
<pre class="code text"><a name="rest_code_422a14d8d353440eb9d51000301e8a69-1"></a>## Warning in extract_numeric("-2-2"): NAs introduced by coercion
<a name="rest_code_422a14d8d353440eb9d51000301e8a69-2"></a>## [1] NA
</pre>
<pre class="code r"><a name="rest_code_0a9eb79b6bce41b48e006194998ba9c5-1"></a>extract_numeric<span class="p">(</span><span class="s">"12abc34"</span><span class="p">)</span>
</pre>
<pre class="code text"><a name="rest_code_7902c689496241fb873686bb10c754fc-1"></a>## [1] 1234
</pre>
</div>
</div>
<div class="section" id="gather">
<h2>gather()</h2>
<div class="section" id="id15">
<h3>Назначение</h3>
<p>Объединяет переменные, имена переменных для объединения становятся уровнями переменной <tt class="docutils literal">key</tt>, значения объединенных переменных заполняют соответственно переменную <tt class="docutils literal">value</tt></p>
</div>
<div class="section" id="id16">
<h3>Использование</h3>
<pre class="code text"><a name="rest_code_5bfa1d560d7e4c4ea681fe2a3991e532-1"></a>gather(data, key, value, ..., na.rm = FALSE, convert = FALSE)
</pre>
</div>
<div class="section" id="id17">
<h3>Аргументы</h3>
<ul class="simple">
<li>
<tt class="docutils literal">data</tt> - оригинальный <tt class="docutils literal">data.frame</tt>
</li>
<li>
<tt class="docutils literal">key</tt>, <tt class="docutils literal">value</tt> - <tt class="docutils literal">key</tt>, <tt class="docutils literal">value</tt> переменные</li>
<li>
<tt class="docutils literal">...</tt> - переменные для объединения, выбор нескольких: <tt class="docutils literal">x:z</tt>, исключить: <tt class="docutils literal"><span class="pre">-y</span></tt>
</li>
<li>
<tt class="docutils literal">na.rm</tt> - если <tt class="docutils literal">TRUE</tt> - удалить все <tt class="docutils literal">NA</tt>
</li>
<li>
<tt class="docutils literal">convert</tt> - если <tt class="docutils literal">TRUE</tt> - применяет <tt class="docutils literal">type.convert</tt> к <tt class="docutils literal">key</tt> переменной</li>
</ul>
</div>
<div class="section" id="id18">
<h3>Примеры использования</h3>
<p>Данные:</p>
<pre class="code r"><a name="rest_code_43c334842cde41cbaae0ece8dbbaa99e-1"></a>stocks <span class="o">&lt;-</span> <span class="kt">data.frame</span><span class="p">(</span>
<a name="rest_code_43c334842cde41cbaae0ece8dbbaa99e-2"></a>time <span class="o">=</span> <span class="kp">as.Date</span><span class="p">(</span><span class="s">'2009-01-01'</span><span class="p">)</span> <span class="o">+</span> <span class="m">0</span><span class="o">:</span><span class="m">9</span><span class="p">,</span>
<a name="rest_code_43c334842cde41cbaae0ece8dbbaa99e-3"></a>X <span class="o">=</span> rnorm<span class="p">(</span><span class="m">10</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">1</span><span class="p">),</span>
<a name="rest_code_43c334842cde41cbaae0ece8dbbaa99e-4"></a>Y <span class="o">=</span> rnorm<span class="p">(</span><span class="m">10</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">2</span><span class="p">),</span>
<a name="rest_code_43c334842cde41cbaae0ece8dbbaa99e-5"></a>Z <span class="o">=</span> rnorm<span class="p">(</span><span class="m">10</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">4</span><span class="p">)</span>
<a name="rest_code_43c334842cde41cbaae0ece8dbbaa99e-6"></a><span class="p">)</span>
<a name="rest_code_43c334842cde41cbaae0ece8dbbaa99e-7"></a>stocks
</pre>
<pre class="code text"><a name="rest_code_ec8f2ab1026e4db19b71aa10d44f8431-1"></a>##          time          X          Y           Z
<a name="rest_code_ec8f2ab1026e4db19b71aa10d44f8431-2"></a>## 1  2009-01-01  0.7722318 -0.3642657 -2.50084998
<a name="rest_code_ec8f2ab1026e4db19b71aa10d44f8431-3"></a>## 2  2009-01-02 -1.1323590  0.7835050 -1.44378404
<a name="rest_code_ec8f2ab1026e4db19b71aa10d44f8431-4"></a>## 3  2009-01-03 -0.8616668 -2.5209075  2.19735867
<a name="rest_code_ec8f2ab1026e4db19b71aa10d44f8431-5"></a>## 4  2009-01-04 -0.6363773 -3.6459329 -2.27906230
<a name="rest_code_ec8f2ab1026e4db19b71aa10d44f8431-6"></a>## 5  2009-01-05  1.3777546  0.6740792  2.47886088
<a name="rest_code_ec8f2ab1026e4db19b71aa10d44f8431-7"></a>## 6  2009-01-06  1.1138555 -2.7431003  2.13743541
<a name="rest_code_ec8f2ab1026e4db19b71aa10d44f8431-8"></a>## 7  2009-01-07 -0.4055423 -0.3971725  0.32445108
<a name="rest_code_ec8f2ab1026e4db19b71aa10d44f8431-9"></a>## 8  2009-01-08 -0.6551642 -1.3071296 -4.39142177
<a name="rest_code_ec8f2ab1026e4db19b71aa10d44f8431-10"></a>## 9  2009-01-09 -0.8421454 -0.9334135 -0.02401832
<a name="rest_code_ec8f2ab1026e4db19b71aa10d44f8431-11"></a>## 10 2009-01-10 -0.1655489 -0.6961085 -0.82861047
</pre>
<p>Объединить имена переменных <tt class="docutils literal">X</tt>, <tt class="docutils literal">Y</tt>, <tt class="docutils literal">Z</tt> в качестве уровней новой переменной <tt class="docutils literal">stock</tt>, значения объединенных переменных заполнят переменную <tt class="docutils literal">price</tt>:</p>
<pre class="code r"><a name="rest_code_faf0f0cb94e54a0b8ef029c2d600de7c-1"></a>stocks <span class="o">%&gt;%</span> gather<span class="p">(</span>stock<span class="p">,</span> price<span class="p">,</span> <span class="o">-</span>time<span class="p">)</span>
</pre>
<pre class="code text"><a name="rest_code_6572f3935e8a4238bdc2b3b1c5ddee52-1"></a>##          time stock       price
<a name="rest_code_6572f3935e8a4238bdc2b3b1c5ddee52-2"></a>## 1  2009-01-01     X  0.77223178
<a name="rest_code_6572f3935e8a4238bdc2b3b1c5ddee52-3"></a>## 2  2009-01-02     X -1.13235898
<a name="rest_code_6572f3935e8a4238bdc2b3b1c5ddee52-4"></a>## 3  2009-01-03     X -0.86166677
<a name="rest_code_6572f3935e8a4238bdc2b3b1c5ddee52-5"></a>## 4  2009-01-04     X -0.63637728
<a name="rest_code_6572f3935e8a4238bdc2b3b1c5ddee52-6"></a>## 5  2009-01-05     X  1.37775462
<a name="rest_code_6572f3935e8a4238bdc2b3b1c5ddee52-7"></a>## 6  2009-01-06     X  1.11385552
<a name="rest_code_6572f3935e8a4238bdc2b3b1c5ddee52-8"></a>## 7  2009-01-07     X -0.40554232
<a name="rest_code_6572f3935e8a4238bdc2b3b1c5ddee52-9"></a>## 8  2009-01-08     X -0.65516418
<a name="rest_code_6572f3935e8a4238bdc2b3b1c5ddee52-10"></a>## 9  2009-01-09     X -0.84214541
<a name="rest_code_6572f3935e8a4238bdc2b3b1c5ddee52-11"></a>## 10 2009-01-10     X -0.16554890
<a name="rest_code_6572f3935e8a4238bdc2b3b1c5ddee52-12"></a>## 11 2009-01-01     Y -0.36426573
<a name="rest_code_6572f3935e8a4238bdc2b3b1c5ddee52-13"></a>## 12 2009-01-02     Y  0.78350495
<a name="rest_code_6572f3935e8a4238bdc2b3b1c5ddee52-14"></a>## 13 2009-01-03     Y -2.52090748
<a name="rest_code_6572f3935e8a4238bdc2b3b1c5ddee52-15"></a>## 14 2009-01-04     Y -3.64593285
<a name="rest_code_6572f3935e8a4238bdc2b3b1c5ddee52-16"></a>## 15 2009-01-05     Y  0.67407924
<a name="rest_code_6572f3935e8a4238bdc2b3b1c5ddee52-17"></a>## 16 2009-01-06     Y -2.74310035
<a name="rest_code_6572f3935e8a4238bdc2b3b1c5ddee52-18"></a>## 17 2009-01-07     Y -0.39717249
<a name="rest_code_6572f3935e8a4238bdc2b3b1c5ddee52-19"></a>## 18 2009-01-08     Y -1.30712963
<a name="rest_code_6572f3935e8a4238bdc2b3b1c5ddee52-20"></a>## 19 2009-01-09     Y -0.93341350
<a name="rest_code_6572f3935e8a4238bdc2b3b1c5ddee52-21"></a>## 20 2009-01-10     Y -0.69610847
<a name="rest_code_6572f3935e8a4238bdc2b3b1c5ddee52-22"></a>## 21 2009-01-01     Z -2.50084998
<a name="rest_code_6572f3935e8a4238bdc2b3b1c5ddee52-23"></a>## 22 2009-01-02     Z -1.44378404
<a name="rest_code_6572f3935e8a4238bdc2b3b1c5ddee52-24"></a>## 23 2009-01-03     Z  2.19735867
<a name="rest_code_6572f3935e8a4238bdc2b3b1c5ddee52-25"></a>## 24 2009-01-04     Z -2.27906230
<a name="rest_code_6572f3935e8a4238bdc2b3b1c5ddee52-26"></a>## 25 2009-01-05     Z  2.47886088
<a name="rest_code_6572f3935e8a4238bdc2b3b1c5ddee52-27"></a>## 26 2009-01-06     Z  2.13743541
<a name="rest_code_6572f3935e8a4238bdc2b3b1c5ddee52-28"></a>## 27 2009-01-07     Z  0.32445108
<a name="rest_code_6572f3935e8a4238bdc2b3b1c5ddee52-29"></a>## 28 2009-01-08     Z -4.39142177
<a name="rest_code_6572f3935e8a4238bdc2b3b1c5ddee52-30"></a>## 29 2009-01-09     Z -0.02401832
<a name="rest_code_6572f3935e8a4238bdc2b3b1c5ddee52-31"></a>## 30 2009-01-10     Z -0.82861047
</pre>
</div>
</div>
<div class="section" id="separate">
<h2>separate()</h2>
<div class="section" id="id19">
<h3>Назначение</h3>
<p>Разбивает переменную на несколько</p>
</div>
<div class="section" id="id20">
<h3>Использование</h3>
<pre class="code text"><a name="rest_code_dd4ce8a06ba448ef8fe1ecd139a2b4a2-1"></a>separate(data, col, into, sep = "[^[:alnum:]]+", remove = TRUE,
<a name="rest_code_dd4ce8a06ba448ef8fe1ecd139a2b4a2-2"></a>         convert = FALSE, extra = "error", ...)
</pre>
</div>
<div class="section" id="id21">
<h3>Аргументы</h3>
<ul class="simple">
<li>
<tt class="docutils literal">data</tt> - оригинальный <tt class="docutils literal">data.frame</tt>
</li>
<li>
<tt class="docutils literal">col</tt> - имя переменной для разбивки</li>
<li>
<tt class="docutils literal">into</tt> - имена новых переменных</li>
<li>
<tt class="docutils literal">sep</tt> - разделитель, если <tt class="docutils literal">character</tt> - воспринимается как регулярное выражение, по-умолчанию - последовательность не цифро-буквенных знаков, если <tt class="docutils literal">numeric</tt> - воспринимается как позиция для разделения</li>
<li>
<tt class="docutils literal">remove</tt> - если <tt class="docutils literal">TRUE</tt> - удаляет <tt class="docutils literal">col</tt> из результирующего <tt class="docutils literal">data.frame</tt>
</li>
<li>
<tt class="docutils literal">convert</tt> - если <tt class="docutils literal">TRUE</tt> - применяет <tt class="docutils literal">type.convert</tt> c <tt class="docutils literal">as.is = TRUE</tt> к новым переменным</li>
<li><dl class="first docutils">
<dt>
<tt class="docutils literal">extra</tt> - если <tt class="docutils literal">sep</tt> - <tt class="docutils literal">character</tt>, то аргумент задает реакцию на превышение допустимого числа новых переменных (<tt class="docutils literal">into</tt>):</dt>
<dd><ul class="first last">
<li>
<tt class="docutils literal">error</tt> - ошибка по-умолчанию</li>
<li>
<tt class="docutils literal">drop</tt> - возвращает <tt class="docutils literal">length(into)</tt>, отбрасывает все сверху или расширяет <tt class="docutils literal">data.frame</tt>
</li>
<li>
<tt class="docutils literal">merge</tt> - разделяет только <tt class="docutils literal">length(into)</tt> раз</li>
</ul></dd>
</dl></li>
<li>
<tt class="docutils literal">...</tt> - дополнительные переменные для <tt class="docutils literal">strsplit</tt>
</li>
</ul>
</div>
<div class="section" id="id22">
<h3>Примеры использования</h3>
<p>Данные:</p>
<pre class="code r"><a name="rest_code_d845b86b8df7403abf0268044224ecb1-1"></a>df <span class="o">&lt;-</span> <span class="kt">data.frame</span><span class="p">(</span>x <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="s">"a.b"</span><span class="p">,</span> <span class="s">"a.d"</span><span class="p">,</span> <span class="s">"b.c"</span><span class="p">))</span>
<a name="rest_code_d845b86b8df7403abf0268044224ecb1-2"></a>df
</pre>
<pre class="code text"><a name="rest_code_2434ee3fb5ca429e9bb96a72956d97c7-1"></a>##     x
<a name="rest_code_2434ee3fb5ca429e9bb96a72956d97c7-2"></a>## 1 a.b
<a name="rest_code_2434ee3fb5ca429e9bb96a72956d97c7-3"></a>## 2 a.d
<a name="rest_code_2434ee3fb5ca429e9bb96a72956d97c7-4"></a>## 3 b.c
</pre>
<p>Разбить переменную <tt class="docutils literal">x</tt> на две, разделитель - <tt class="docutils literal">.</tt>:</p>
<pre class="code r"><a name="rest_code_90563abc53e24b9aa1b4d97dd5f5699d-1"></a>df <span class="o">%&gt;%</span> separate<span class="p">(</span>x<span class="p">,</span> <span class="kt">c</span><span class="p">(</span><span class="s">"A"</span><span class="p">,</span> <span class="s">"B"</span><span class="p">))</span>
</pre>
<pre class="code text"><a name="rest_code_aaf3d4b103ac4b6eabc28d026d73c971-1"></a>##   A B
<a name="rest_code_aaf3d4b103ac4b6eabc28d026d73c971-2"></a>## 1 a b
<a name="rest_code_aaf3d4b103ac4b6eabc28d026d73c971-3"></a>## 2 a d
<a name="rest_code_aaf3d4b103ac4b6eabc28d026d73c971-4"></a>## 3 b c
</pre>
<p>Если строки нельзя разделить на равное число переменных:</p>
<pre class="code r"><a name="rest_code_135c76f07e3b4cbca4b65259201b3d7b-1"></a>df <span class="o">&lt;-</span> <span class="kt">data.frame</span><span class="p">(</span>x <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="s">"a"</span><span class="p">,</span> <span class="s">"a b"</span><span class="p">,</span> <span class="s">"a b c"</span><span class="p">))</span>
<a name="rest_code_135c76f07e3b4cbca4b65259201b3d7b-2"></a>df <span class="o">%&gt;%</span> separate<span class="p">(</span>x<span class="p">,</span> <span class="kt">c</span><span class="p">(</span><span class="s">"a"</span><span class="p">,</span> <span class="s">"b"</span><span class="p">),</span> extra <span class="o">=</span> <span class="s">"merge"</span><span class="p">)</span>
</pre>
<pre class="code text"><a name="rest_code_7a817d008114412f9bde97c448861180-1"></a>##   a    b
<a name="rest_code_7a817d008114412f9bde97c448861180-2"></a>## 1 a &lt;NA&gt;
<a name="rest_code_7a817d008114412f9bde97c448861180-3"></a>## 2 a    b
<a name="rest_code_7a817d008114412f9bde97c448861180-4"></a>## 3 a  b c
</pre>
<pre class="code r"><a name="rest_code_3013303020884f96b888b98207b69f31-1"></a>df <span class="o">%&gt;%</span> separate<span class="p">(</span>x<span class="p">,</span> <span class="kt">c</span><span class="p">(</span><span class="s">"a"</span><span class="p">,</span> <span class="s">"b"</span><span class="p">),</span> extra <span class="o">=</span> <span class="s">"drop"</span><span class="p">)</span>
</pre>
<pre class="code text"><a name="rest_code_a3dd56d7dbd34f75804452228cce28fb-1"></a>##   a    b
<a name="rest_code_a3dd56d7dbd34f75804452228cce28fb-2"></a>## 1 a &lt;NA&gt;
<a name="rest_code_a3dd56d7dbd34f75804452228cce28fb-3"></a>## 2 a    b
<a name="rest_code_a3dd56d7dbd34f75804452228cce28fb-4"></a>## 3 a    b
</pre>
<p>Данные:</p>
<pre class="code r"><a name="rest_code_32d46d3c5bdf4947bf3bfee05846ffcb-1"></a>df <span class="o">&lt;-</span> <span class="kt">data.frame</span><span class="p">(</span>x <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="s">"x: 123"</span><span class="p">,</span> <span class="s">"y: error: 7"</span><span class="p">))</span>
<a name="rest_code_32d46d3c5bdf4947bf3bfee05846ffcb-2"></a>df
</pre>
<pre class="code text"><a name="rest_code_6d48847d223e4c7ead324f642f2f80cd-1"></a>##             x
<a name="rest_code_6d48847d223e4c7ead324f642f2f80cd-2"></a>## 1      x: 123
<a name="rest_code_6d48847d223e4c7ead324f642f2f80cd-3"></a>## 2 y: error: 7
</pre>
<p>Разбить строки строго на две переменные по первому включению <tt class="docutils literal">sep</tt>:</p>
<pre class="code r"><a name="rest_code_94aceffc64fb45bb87d304adf104cfef-1"></a>df <span class="o">%&gt;%</span> separate<span class="p">(</span>x<span class="p">,</span> <span class="kt">c</span><span class="p">(</span><span class="s">"key"</span><span class="p">,</span> <span class="s">"value"</span><span class="p">),</span> <span class="s">": "</span><span class="p">,</span> extra <span class="o">=</span> <span class="s">"merge"</span><span class="p">)</span>
</pre>
<pre class="code text"><a name="rest_code_7102c38156ef4ccbafa9764f1758a4e5-1"></a>##   key    value
<a name="rest_code_7102c38156ef4ccbafa9764f1758a4e5-2"></a>## 1   x      123
<a name="rest_code_7102c38156ef4ccbafa9764f1758a4e5-3"></a>## 2   y error: 7
</pre>
</div>
</div>
<div class="section" id="seq-range">
<h2>seq_range()</h2>
<div class="section" id="id23">
<h3>Назначение</h3>
<p>Возвращает вектор из <tt class="docutils literal">n</tt> значений <tt class="docutils literal">x</tt> от минимального до максимального с равными промежутками</p>
</div>
<div class="section" id="id24">
<h3>Использование</h3>
<pre class="code text"><a name="rest_code_f37e02efbc2d4f04b813f8ce5145ea75-1"></a>seq_range(x, n)
</pre>
</div>
<div class="section" id="id25">
<h3>Аргументы</h3>
<ul class="simple">
<li>
<tt class="docutils literal">x</tt> - <tt class="docutils literal">numeric vector</tt>
</li>
<li>
<tt class="docutils literal">n</tt> - число значений</li>
</ul>
</div>
<div class="section" id="id26">
<h3>Примеры использования</h3>
<p>Разобьем диапазон значений вектора <tt class="docutils literal">1:100</tt>:</p>
<pre class="code r"><a name="rest_code_908c4ad6452d46b3a9a4716293e5b40b-1"></a>seq_range<span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">100</span><span class="p">,</span> <span class="m">5</span><span class="p">)</span>
</pre>
<pre class="code text"><a name="rest_code_a7e28c703cdc458e8433292cb4bea3ec-1"></a>## [1]   1.00  25.75  50.50  75.25 100.00
</pre>
</div>
</div>
<div class="section" id="spread">
<h2>spread()</h2>
<div class="section" id="id27">
<h3>Назначение</h3>
<p>Переформатирует <tt class="docutils literal">data.frame</tt> - используя в качестве имен новых переменных уровни заданной переменной <tt class="docutils literal">key</tt>, а в качестве значений - соответствующие значения переменной <tt class="docutils literal">value</tt>.</p>
</div>
<div class="section" id="id28">
<h3>Использование</h3>
<pre class="code text"><a name="rest_code_e1bc57d2f3bd46a9adba76230046c7bb-1"></a>spread(data, key, value, fill = NA, convert = FALSE, drop = TRUE)
</pre>
</div>
<div class="section" id="id29">
<h3>Аргументы</h3>
<ul class="simple">
<li>
<tt class="docutils literal">data</tt> - <tt class="docutils literal">numeric vector</tt>
</li>
<li>
<tt class="docutils literal">key</tt> - переменная, чьи уровни станут новыми переменными</li>
<li>
<tt class="docutils literal">value</tt> - переменная, соответствующими значениями которой будут заполнены новые столбцы</li>
<li>
<tt class="docutils literal">fill</tt> - если для комбинации переменной <tt class="docutils literal">key</tt> и других переменных нет значения - подставляет на его место указанное</li>
<li>
<tt class="docutils literal">convert</tt> - если <tt class="docutils literal">TRUE</tt> - применяет <tt class="docutils literal">type.convert</tt> c <tt class="docutils literal">as.is = TRUE</tt> к новым переменным</li>
<li>
<tt class="docutils literal">drop</tt> - если <tt class="docutils literal">FALSE</tt> - сохранить уровни факторов, для которых нет значений в данных, заполняя их по правилу <tt class="docutils literal">fill</tt>
</li>
</ul>
</div>
<div class="section" id="id30">
<h3>Примеры использования</h3>
<p>Данные:</p>
<pre class="code r"><a name="rest_code_a40eccc3c62049fcb5abe4741371a97d-1"></a>stocks <span class="o">&lt;-</span> <span class="kt">data.frame</span><span class="p">(</span>
<a name="rest_code_a40eccc3c62049fcb5abe4741371a97d-2"></a>time <span class="o">=</span> <span class="kp">as.Date</span><span class="p">(</span><span class="s">'2009-01-01'</span><span class="p">)</span> <span class="o">+</span> <span class="m">0</span><span class="o">:</span><span class="m">9</span><span class="p">,</span>
<a name="rest_code_a40eccc3c62049fcb5abe4741371a97d-3"></a>X <span class="o">=</span> rnorm<span class="p">(</span><span class="m">10</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">1</span><span class="p">),</span>
<a name="rest_code_a40eccc3c62049fcb5abe4741371a97d-4"></a>Y <span class="o">=</span> rnorm<span class="p">(</span><span class="m">10</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">2</span><span class="p">),</span>
<a name="rest_code_a40eccc3c62049fcb5abe4741371a97d-5"></a>Z <span class="o">=</span> rnorm<span class="p">(</span><span class="m">10</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">4</span><span class="p">)</span>
<a name="rest_code_a40eccc3c62049fcb5abe4741371a97d-6"></a><span class="p">)</span>
<a name="rest_code_a40eccc3c62049fcb5abe4741371a97d-7"></a>stocks
</pre>
<pre class="code text"><a name="rest_code_0081d8282e684ecdb2b6e6b09a0daa2f-1"></a>##          time          X          Y          Z
<a name="rest_code_0081d8282e684ecdb2b6e6b09a0daa2f-2"></a>## 1  2009-01-01  0.3911387  2.0635862 -6.3953715
<a name="rest_code_0081d8282e684ecdb2b6e6b09a0daa2f-3"></a>## 2  2009-01-02  0.1203100 -1.3411346 -4.5907582
<a name="rest_code_0081d8282e684ecdb2b6e6b09a0daa2f-4"></a>## 3  2009-01-03 -0.3916139 -0.3763128 -0.6275635
<a name="rest_code_0081d8282e684ecdb2b6e6b09a0daa2f-5"></a>## 4  2009-01-04 -0.2890859  1.0035137 -2.9846424
<a name="rest_code_0081d8282e684ecdb2b6e6b09a0daa2f-6"></a>## 5  2009-01-05  0.2296824  1.0974012  0.6136485
<a name="rest_code_0081d8282e684ecdb2b6e6b09a0daa2f-7"></a>## 6  2009-01-06  0.0278537  4.9167183 -5.7563632
<a name="rest_code_0081d8282e684ecdb2b6e6b09a0daa2f-8"></a>## 7  2009-01-07  0.7349981  0.4856101 -6.7558963
<a name="rest_code_0081d8282e684ecdb2b6e6b09a0daa2f-9"></a>## 8  2009-01-08 -0.5096926 -0.8247462  2.5661235
<a name="rest_code_0081d8282e684ecdb2b6e6b09a0daa2f-10"></a>## 9  2009-01-09  0.2338707 -0.5513422 -0.6923370
<a name="rest_code_0081d8282e684ecdb2b6e6b09a0daa2f-11"></a>## 10 2009-01-10  2.3231925  0.2870178  1.7580478
</pre>
<p>Противоположность <tt class="docutils literal">gather</tt>:</p>
<pre class="code r"><a name="rest_code_2a3066bd9ea34f1a8ab928c7ea29e713-1"></a>stocksm <span class="o">&lt;-</span> stocks <span class="o">%&gt;%</span> gather<span class="p">(</span>stock<span class="p">,</span> price<span class="p">,</span> <span class="o">-</span>time<span class="p">)</span>
<a name="rest_code_2a3066bd9ea34f1a8ab928c7ea29e713-2"></a><span class="kp">head</span><span class="p">(</span>stocksm<span class="p">)</span>
</pre>
<pre class="code text"><a name="rest_code_80babfbc2cec491c9b40f001dea96e11-1"></a>##         time stock      price
<a name="rest_code_80babfbc2cec491c9b40f001dea96e11-2"></a>## 1 2009-01-01     X  0.3911387
<a name="rest_code_80babfbc2cec491c9b40f001dea96e11-3"></a>## 2 2009-01-02     X  0.1203100
<a name="rest_code_80babfbc2cec491c9b40f001dea96e11-4"></a>## 3 2009-01-03     X -0.3916139
<a name="rest_code_80babfbc2cec491c9b40f001dea96e11-5"></a>## 4 2009-01-04     X -0.2890859
<a name="rest_code_80babfbc2cec491c9b40f001dea96e11-6"></a>## 5 2009-01-05     X  0.2296824
<a name="rest_code_80babfbc2cec491c9b40f001dea96e11-7"></a>## 6 2009-01-06     X  0.0278537
</pre>
<pre class="code r"><a name="rest_code_43efc0c1529e4d698d7c0cf0938e3c67-1"></a>stocksm <span class="o">%&gt;%</span> spread<span class="p">(</span>stock<span class="p">,</span> price<span class="p">)</span>
</pre>
<pre class="code text"><a name="rest_code_44a6a38c21e7475cb9fea743ae3e8a72-1"></a>##          time          X          Y          Z
<a name="rest_code_44a6a38c21e7475cb9fea743ae3e8a72-2"></a>## 1  2009-01-01  0.3911387  2.0635862 -6.3953715
<a name="rest_code_44a6a38c21e7475cb9fea743ae3e8a72-3"></a>## 2  2009-01-02  0.1203100 -1.3411346 -4.5907582
<a name="rest_code_44a6a38c21e7475cb9fea743ae3e8a72-4"></a>## 3  2009-01-03 -0.3916139 -0.3763128 -0.6275635
<a name="rest_code_44a6a38c21e7475cb9fea743ae3e8a72-5"></a>## 4  2009-01-04 -0.2890859  1.0035137 -2.9846424
<a name="rest_code_44a6a38c21e7475cb9fea743ae3e8a72-6"></a>## 5  2009-01-05  0.2296824  1.0974012  0.6136485
<a name="rest_code_44a6a38c21e7475cb9fea743ae3e8a72-7"></a>## 6  2009-01-06  0.0278537  4.9167183 -5.7563632
<a name="rest_code_44a6a38c21e7475cb9fea743ae3e8a72-8"></a>## 7  2009-01-07  0.7349981  0.4856101 -6.7558963
<a name="rest_code_44a6a38c21e7475cb9fea743ae3e8a72-9"></a>## 8  2009-01-08 -0.5096926 -0.8247462  2.5661235
<a name="rest_code_44a6a38c21e7475cb9fea743ae3e8a72-10"></a>## 9  2009-01-09  0.2338707 -0.5513422 -0.6923370
<a name="rest_code_44a6a38c21e7475cb9fea743ae3e8a72-11"></a>## 10 2009-01-10  2.3231925  0.2870178  1.7580478
</pre>
<p>Разбить <tt class="docutils literal">price</tt> по переменной <tt class="docutils literal">time</tt>:</p>
<pre class="code r"><a name="rest_code_98a6038b40924c1aa9d3e4398f8c9ab0-1"></a>stocksm <span class="o">%&gt;%</span> spread<span class="p">(</span>time<span class="p">,</span> price<span class="p">)</span>
</pre>
<pre class="code text"><a name="rest_code_96ca4562c01b400c81ad8ca981afd935-1"></a>##   stock 2009-01-01 2009-01-02 2009-01-03 2009-01-04 2009-01-05 2009-01-06
<a name="rest_code_96ca4562c01b400c81ad8ca981afd935-2"></a>## 1     X  0.3911387   0.120310 -0.3916139 -0.2890859  0.2296824  0.0278537
<a name="rest_code_96ca4562c01b400c81ad8ca981afd935-3"></a>## 2     Y  2.0635862  -1.341135 -0.3763128  1.0035137  1.0974012  4.9167183
<a name="rest_code_96ca4562c01b400c81ad8ca981afd935-4"></a>## 3     Z -6.3953715  -4.590758 -0.6275635 -2.9846424  0.6136485 -5.7563632
<a name="rest_code_96ca4562c01b400c81ad8ca981afd935-5"></a>##   2009-01-07 2009-01-08 2009-01-09 2009-01-10
<a name="rest_code_96ca4562c01b400c81ad8ca981afd935-6"></a>## 1  0.7349981 -0.5096926  0.2338707  2.3231925
<a name="rest_code_96ca4562c01b400c81ad8ca981afd935-7"></a>## 2  0.4856101 -0.8247462 -0.5513422  0.2870178
<a name="rest_code_96ca4562c01b400c81ad8ca981afd935-8"></a>## 3 -6.7558963  2.5661235 -0.6923370  1.7580478
</pre>
</div>
</div>
<div class="section" id="unite">
<h2>unite()</h2>
<div class="section" id="id31">
<h3>Назначение</h3>
<p>Объединяет переменные в одну</p>
</div>
<div class="section" id="id32">
<h3>Использование</h3>
<pre class="code text"><a name="rest_code_e64d9ddee471447899270734d83a9066-1"></a>unite(data, col, ..., sep = "_", remove = TRUE)
</pre>
</div>
<div class="section" id="id33">
<h3>Аргументы</h3>
<ul class="simple">
<li>
<tt class="docutils literal">data</tt> - <tt class="docutils literal">numeric vector</tt>
</li>
<li>
<tt class="docutils literal">col</tt> - имя базовой переменной</li>
<li>
<tt class="docutils literal">...</tt> - переменные для объединения с базовой</li>
<li>
<tt class="docutils literal">sep</tt> - разделитель между значениями объединенных переменных</li>
<li>
<tt class="docutils literal">remove</tt> - если <tt class="docutils literal">TRUE</tt> - удаляет переменные для объединения</li>
</ul>
</div>
<div class="section" id="id34">
<h3>Примеры использования</h3>
<p>Объединяем переменные <tt class="docutils literal">vs</tt> и <tt class="docutils literal">am</tt> в одну:</p>
<pre class="code r"><a name="rest_code_8fae73adcd9b46d6806458fcffc41a3c-1"></a>mtcars <span class="o">%&gt;%</span>
<a name="rest_code_8fae73adcd9b46d6806458fcffc41a3c-2"></a>  unite_<span class="p">(</span><span class="s">"vs_am"</span><span class="p">,</span> <span class="kt">c</span><span class="p">(</span><span class="s">"vs"</span><span class="p">,</span> <span class="s">"am"</span><span class="p">))</span> <span class="o">%&gt;%</span>
<a name="rest_code_8fae73adcd9b46d6806458fcffc41a3c-3"></a>  <span class="kp">head</span><span class="p">()</span>
</pre>
<pre class="code text"><a name="rest_code_5befc5af304c47bf8de9c1496c1cb302-1"></a>##                    mpg cyl disp  hp drat    wt  qsec vs_am gear carb
<a name="rest_code_5befc5af304c47bf8de9c1496c1cb302-2"></a>## Mazda RX4         21.0   6  160 110 3.90 2.620 16.46   0_1    4    4
<a name="rest_code_5befc5af304c47bf8de9c1496c1cb302-3"></a>## Mazda RX4 Wag     21.0   6  160 110 3.90 2.875 17.02   0_1    4    4
<a name="rest_code_5befc5af304c47bf8de9c1496c1cb302-4"></a>## Datsun 710        22.8   4  108  93 3.85 2.320 18.61   1_1    4    1
<a name="rest_code_5befc5af304c47bf8de9c1496c1cb302-5"></a>## Hornet 4 Drive    21.4   6  258 110 3.08 3.215 19.44   1_0    3    1
<a name="rest_code_5befc5af304c47bf8de9c1496c1cb302-6"></a>## Hornet Sportabout 18.7   8  360 175 3.15 3.440 17.02   0_0    3    2
<a name="rest_code_5befc5af304c47bf8de9c1496c1cb302-7"></a>## Valiant           18.1   6  225 105 2.76 3.460 20.22   1_0    3    1
</pre>
<p>Противоположность <tt class="docutils literal">separate</tt>:</p>
<pre class="code r"><a name="rest_code_0656b6e8e22444068c82c9569ebb0a7e-1"></a>mtcars <span class="o">%&gt;%</span>
<a name="rest_code_0656b6e8e22444068c82c9569ebb0a7e-2"></a>  unite<span class="p">(</span>vs_am<span class="p">,</span> vs<span class="p">,</span> am<span class="p">)</span> <span class="o">%&gt;%</span>
<a name="rest_code_0656b6e8e22444068c82c9569ebb0a7e-3"></a>  separate<span class="p">(</span>vs_am<span class="p">,</span> <span class="kt">c</span><span class="p">(</span><span class="s">"vs"</span><span class="p">,</span> <span class="s">"am"</span><span class="p">))</span> <span class="o">%&gt;%</span>
<a name="rest_code_0656b6e8e22444068c82c9569ebb0a7e-4"></a>  <span class="kp">head</span><span class="p">()</span>
</pre>
<pre class="code text"><a name="rest_code_ed51d89f519946718022cd53e838702b-1"></a>##                    mpg cyl disp  hp drat    wt  qsec vs am gear carb
<a name="rest_code_ed51d89f519946718022cd53e838702b-2"></a>## Mazda RX4         21.0   6  160 110 3.90 2.620 16.46  0  1    4    4
<a name="rest_code_ed51d89f519946718022cd53e838702b-3"></a>## Mazda RX4 Wag     21.0   6  160 110 3.90 2.875 17.02  0  1    4    4
<a name="rest_code_ed51d89f519946718022cd53e838702b-4"></a>## Datsun 710        22.8   4  108  93 3.85 2.320 18.61  1  1    4    1
<a name="rest_code_ed51d89f519946718022cd53e838702b-5"></a>## Hornet 4 Drive    21.4   6  258 110 3.08 3.215 19.44  1  0    3    1
<a name="rest_code_ed51d89f519946718022cd53e838702b-6"></a>## Hornet Sportabout 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2
<a name="rest_code_ed51d89f519946718022cd53e838702b-7"></a>## Valiant           18.1   6  225 105 2.76 3.460 20.22  1  0    3    1
</pre>
</div>
</div>
<div class="section" id="unnest">
<h2>unnest()</h2>
<div class="section" id="id35">
<h3>Назначение</h3>
<p>Разбивает переменную на большее число строк за счет раскрытия вложенных элементов</p>
</div>
<div class="section" id="id36">
<h3>Использование</h3>
<pre class="code text"><a name="rest_code_bcf63c8e97344a42851236c79af2833f-1"></a>unnest(data, col = NULL)
</pre>
</div>
<div class="section" id="id37">
<h3>Аргументы</h3>
<ul class="simple">
<li>
<tt class="docutils literal">data</tt> - оригинальный <tt class="docutils literal">data.frame</tt>
</li>
<li>
<tt class="docutils literal">col</tt> - переменная, которую нужно разбить на большее число строк</li>
</ul>
</div>
<div class="section" id="id38">
<h3>Примеры использования</h3>
<p>Данные:</p>
<pre class="code r"><a name="rest_code_8e8f09241d204eae8dfcba777e143b5b-1"></a>df <span class="o">&lt;-</span> <span class="kt">data.frame</span><span class="p">(</span>
<a name="rest_code_8e8f09241d204eae8dfcba777e143b5b-2"></a>x <span class="o">=</span> <span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">,</span>
<a name="rest_code_8e8f09241d204eae8dfcba777e143b5b-3"></a>y <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="s">"a"</span><span class="p">,</span> <span class="s">"d,e,f"</span><span class="p">,</span> <span class="s">"g,h"</span><span class="p">),</span>
<a name="rest_code_8e8f09241d204eae8dfcba777e143b5b-4"></a>stringsAsFactors <span class="o">=</span> <span class="kc">FALSE</span>
<a name="rest_code_8e8f09241d204eae8dfcba777e143b5b-5"></a><span class="p">)</span>
<a name="rest_code_8e8f09241d204eae8dfcba777e143b5b-6"></a>df
</pre>
<pre class="code text"><a name="rest_code_6f81fa271a70412cb1a7d6d993e45ddf-1"></a>##   x     y
<a name="rest_code_6f81fa271a70412cb1a7d6d993e45ddf-2"></a>## 1 1     a
<a name="rest_code_6f81fa271a70412cb1a7d6d993e45ddf-3"></a>## 2 2 d,e,f
<a name="rest_code_6f81fa271a70412cb1a7d6d993e45ddf-4"></a>## 3 3   g,h
</pre>
<p>Разбить переменную <tt class="docutils literal">y</tt> на большее число строк:</p>
<pre class="code r"><a name="rest_code_d3659309a14941509799e1609b9f7c15-1"></a>df <span class="o">%&gt;%</span>
<a name="rest_code_d3659309a14941509799e1609b9f7c15-2"></a>  <span class="kp">transform</span><span class="p">(</span>y <span class="o">=</span> <span class="kp">strsplit</span><span class="p">(</span>y<span class="p">,</span> <span class="s">","</span><span class="p">))</span> <span class="o">%&gt;%</span>
<a name="rest_code_d3659309a14941509799e1609b9f7c15-3"></a>  unnest<span class="p">(</span>y<span class="p">)</span>
</pre>
<pre class="code text"><a name="rest_code_fd81f09e24bb4029be95b73d60f69b48-1"></a>##   x y
<a name="rest_code_fd81f09e24bb4029be95b73d60f69b48-2"></a>## 1 1 a
<a name="rest_code_fd81f09e24bb4029be95b73d60f69b48-3"></a>## 2 2 d
<a name="rest_code_fd81f09e24bb4029be95b73d60f69b48-4"></a>## 3 2 e
<a name="rest_code_fd81f09e24bb4029be95b73d60f69b48-5"></a>## 4 2 f
<a name="rest_code_fd81f09e24bb4029be95b73d60f69b48-6"></a>## 5 3 g
<a name="rest_code_fd81f09e24bb4029be95b73d60f69b48-7"></a>## 6 3 h
</pre>
<p>Разобьем стандартный набор данных <tt class="docutils literal">iris</tt> по виду цветка:</p>
<pre class="code r"><a name="rest_code_268619bc9f9746088aa74c57adb9bf6e-1"></a>my_list <span class="o">&lt;-</span> <span class="kp">lapply</span><span class="p">(</span><span class="kp">split</span><span class="p">(</span><span class="kp">subset</span><span class="p">(</span>iris<span class="p">,</span> select <span class="o">=</span> <span class="o">-</span>Species<span class="p">),</span>iris<span class="o">$</span>Species<span class="p">),</span>
<a name="rest_code_268619bc9f9746088aa74c57adb9bf6e-2"></a>                  <span class="s">"["</span><span class="p">,</span> <span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">,</span> <span class="p">)</span>
<a name="rest_code_268619bc9f9746088aa74c57adb9bf6e-3"></a>my_list
</pre>
<pre class="code text"><a name="rest_code_11362e8d9a734e9ead786958462dd5ab-1"></a>## $setosa
<a name="rest_code_11362e8d9a734e9ead786958462dd5ab-2"></a>##   Sepal.Length Sepal.Width Petal.Length Petal.Width
<a name="rest_code_11362e8d9a734e9ead786958462dd5ab-3"></a>## 1          5.1         3.5          1.4         0.2
<a name="rest_code_11362e8d9a734e9ead786958462dd5ab-4"></a>## 2          4.9         3.0          1.4         0.2
<a name="rest_code_11362e8d9a734e9ead786958462dd5ab-5"></a>##
<a name="rest_code_11362e8d9a734e9ead786958462dd5ab-6"></a>## $versicolor
<a name="rest_code_11362e8d9a734e9ead786958462dd5ab-7"></a>##    Sepal.Length Sepal.Width Petal.Length Petal.Width
<a name="rest_code_11362e8d9a734e9ead786958462dd5ab-8"></a>## 51          7.0         3.2          4.7         1.4
<a name="rest_code_11362e8d9a734e9ead786958462dd5ab-9"></a>## 52          6.4         3.2          4.5         1.5
<a name="rest_code_11362e8d9a734e9ead786958462dd5ab-10"></a>##
<a name="rest_code_11362e8d9a734e9ead786958462dd5ab-11"></a>## $virginica
<a name="rest_code_11362e8d9a734e9ead786958462dd5ab-12"></a>##     Sepal.Length Sepal.Width Petal.Length Petal.Width
<a name="rest_code_11362e8d9a734e9ead786958462dd5ab-13"></a>## 101          6.3         3.3          6.0         2.5
<a name="rest_code_11362e8d9a734e9ead786958462dd5ab-14"></a>## 102          5.8         2.7          5.1         1.9
</pre>
<p>Соберем список обратно в <tt class="docutils literal">data.frame</tt>:</p>
<pre class="code r"><a name="rest_code_8890a4da1cf2421c81700a72132f1a4c-1"></a>unnest<span class="p">(</span>my_list<span class="p">)</span>
</pre>
<pre class="code text"><a name="rest_code_5230224f74d749eba91f6fa8d5545440-1"></a>## Source: local data frame [6 x 4]
<a name="rest_code_5230224f74d749eba91f6fa8d5545440-2"></a>##
<a name="rest_code_5230224f74d749eba91f6fa8d5545440-3"></a>##   Sepal.Length Sepal.Width Petal.Length Petal.Width
<a name="rest_code_5230224f74d749eba91f6fa8d5545440-4"></a>## 1          5.1         3.5          1.4         0.2
<a name="rest_code_5230224f74d749eba91f6fa8d5545440-5"></a>## 2          4.9         3.0          1.4         0.2
<a name="rest_code_5230224f74d749eba91f6fa8d5545440-6"></a>## 3          7.0         3.2          4.7         1.4
<a name="rest_code_5230224f74d749eba91f6fa8d5545440-7"></a>## 4          6.4         3.2          4.5         1.5
<a name="rest_code_5230224f74d749eba91f6fa8d5545440-8"></a>## 5          6.3         3.3          6.0         2.5
<a name="rest_code_5230224f74d749eba91f6fa8d5545440-9"></a>## 6          5.8         2.7          5.1         1.9
</pre>
<p>Добавим потерявшуюся переменную <tt class="docutils literal">Species</tt>:</p>
<pre class="code r"><a name="rest_code_d4ebe95aebd841479aa237972a2f8047-1"></a>unnest<span class="p">(</span>my_list<span class="p">,</span> Species<span class="p">)</span>
</pre>
<pre class="code text"><a name="rest_code_3579a7b97437422884cf80a457836de9-1"></a>##      Species Sepal.Length Sepal.Width Petal.Length Petal.Width
<a name="rest_code_3579a7b97437422884cf80a457836de9-2"></a>## 1     setosa          5.1         3.5          1.4         0.2
<a name="rest_code_3579a7b97437422884cf80a457836de9-3"></a>## 2     setosa          4.9         3.0          1.4         0.2
<a name="rest_code_3579a7b97437422884cf80a457836de9-4"></a>## 3 versicolor          7.0         3.2          4.7         1.4
<a name="rest_code_3579a7b97437422884cf80a457836de9-5"></a>## 4 versicolor          6.4         3.2          4.5         1.5
<a name="rest_code_3579a7b97437422884cf80a457836de9-6"></a>## 5  virginica          6.3         3.3          6.0         2.5
<a name="rest_code_3579a7b97437422884cf80a457836de9-7"></a>## 6  virginica          5.8         2.7          5.1         1.9
</pre>
</div>
</div>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/2014/11/03/mosaic-plot/" class="u-url">Мозаичные диаграммы в ggplot2</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Pavel Karateev
            </span></p>
            <p class="dateline"><a href="posts/2014/11/03/mosaic-plot/" rel="bookmark"><time class="published dt-published" datetime="2014-11-03T00:00:00+03:00" title="2014-11-03 00:00">2014-11-03 00:00</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<p>Сегодня на повестке дня мозаичные диаграммы в <strong>R</strong> при помощи <tt class="docutils literal">ggplot2</tt>. И,
да, в <tt class="docutils literal">ggplot2</tt> нет их реализации "из коробки", но с должным умением и
достаточно большой кувалдой дело можно поправить.</p>
<p>В процессе поиска подходящей реализации (идей) мне попалось несколько вариантов
построения мозаичной диаграммы в <tt class="docutils literal">ggplot2</tt>, лучшей из всех, на мой вззгляд,
является реализация пользователя <a class="reference external" href="http://stackoverflow.com/a/19258045">Edwin</a> со stackoverflow с дополнениями из
блога [Learning R][2]. Если будете изучать способ из блога - учтите что
рекомендации несколько устарели (<tt class="docutils literal">ddply</tt>, <tt class="docutils literal">opts</tt>, <tt class="docutils literal">theme_line</tt>) и автор забыл
упомянуть о (<tt class="docutils literal">library(reshape2)</tt> и <tt class="docutils literal">library(plyr)</tt>).</p>
<p>Нам потребуется только <tt class="docutils literal">ggplot2</tt>:</p>
<pre class="code r"><a name="rest_code_d740bdaea33c4033a5f350ce13f608e8-1"></a><span class="kn">library</span><span class="p">(</span>ggplot2<span class="p">)</span>
</pre>
<pre class="code text"><a name="rest_code_a70179326e7b4e47a13b4fa9e8ea9d0b-1"></a>## Loading required package: methods
</pre>
<p>Для примера будем использовать массив данных о бриллиантах, он идет в комплекте
с <tt class="docutils literal">ggplot2</tt>:</p>
<pre class="code r"><a name="rest_code_8a13bbb65f014791b7c542190d00fa81-1"></a><span class="kp">head</span><span class="p">(</span>diamonds<span class="p">)</span>
</pre>
<pre class="code r"><a name="rest_code_94f23bfe913c47b1b1c522247f80be30-1"></a><span class="c1">##   carat       cut color clarity depth table price    x    y    z</span>
<a name="rest_code_94f23bfe913c47b1b1c522247f80be30-2"></a><span class="c1">## 1  0.23     Ideal     E     SI2  61.5    55   326 3.95 3.98 2.43</span>
<a name="rest_code_94f23bfe913c47b1b1c522247f80be30-3"></a><span class="c1">## 2  0.21   Premium     E     SI1  59.8    61   326 3.89 3.84 2.31</span>
<a name="rest_code_94f23bfe913c47b1b1c522247f80be30-4"></a><span class="c1">## 3  0.23      Good     E     VS1  56.9    65   327 4.05 4.07 2.31</span>
<a name="rest_code_94f23bfe913c47b1b1c522247f80be30-5"></a><span class="c1">## 4  0.29   Premium     I     VS2  62.4    58   334 4.20 4.23 2.63</span>
<a name="rest_code_94f23bfe913c47b1b1c522247f80be30-6"></a><span class="c1">## 5  0.31      Good     J     SI2  63.3    58   335 4.34 4.35 2.75</span>
<a name="rest_code_94f23bfe913c47b1b1c522247f80be30-7"></a><span class="c1">## 6  0.24 Very Good     J    VVS2  62.8    57   336 3.94 3.96 2.48</span>
</pre>
<p>Мозаичную диаграмму мы будем строить через вспомогательную функцию <tt class="docutils literal">ggMMplot</tt>,
которая будет принимать две дискретные переменные:</p>
<pre class="code r"><a name="rest_code_0d815db3a4734fccb1ee50c8009fc6a2-1"></a>ggMMplot <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>var1<span class="p">,</span> var2<span class="p">){</span>
<a name="rest_code_0d815db3a4734fccb1ee50c8009fc6a2-2"></a>  <span class="c1"># ggplot2 должен быть загружен</span>
<a name="rest_code_0d815db3a4734fccb1ee50c8009fc6a2-3"></a>  <span class="kn">require</span><span class="p">(</span>ggplot2<span class="p">)</span>
<a name="rest_code_0d815db3a4734fccb1ee50c8009fc6a2-4"></a>
<a name="rest_code_0d815db3a4734fccb1ee50c8009fc6a2-5"></a>  <span class="c1"># Подсчитываем диапазон значений дискретных переменных</span>
<a name="rest_code_0d815db3a4734fccb1ee50c8009fc6a2-6"></a>  levVar1 <span class="o">&lt;-</span> <span class="kp">length</span><span class="p">(</span><span class="kp">levels</span><span class="p">(</span>var1<span class="p">))</span>
<a name="rest_code_0d815db3a4734fccb1ee50c8009fc6a2-7"></a>  levVar2 <span class="o">&lt;-</span> <span class="kp">length</span><span class="p">(</span><span class="kp">levels</span><span class="p">(</span>var2<span class="p">))</span>
<a name="rest_code_0d815db3a4734fccb1ee50c8009fc6a2-8"></a>
<a name="rest_code_0d815db3a4734fccb1ee50c8009fc6a2-9"></a>  <span class="c1"># Строим таблицу вероятностей</span>
<a name="rest_code_0d815db3a4734fccb1ee50c8009fc6a2-10"></a>  jointTable <span class="o">&lt;-</span> <span class="kp">prop.table</span><span class="p">(</span><span class="kp">table</span><span class="p">(</span>var1<span class="p">,</span> var2<span class="p">))</span>
<a name="rest_code_0d815db3a4734fccb1ee50c8009fc6a2-11"></a>
<a name="rest_code_0d815db3a4734fccb1ee50c8009fc6a2-12"></a>  <span class="c1"># Начинаем собирать data.frame, который будет использован для построения</span>
<a name="rest_code_0d815db3a4734fccb1ee50c8009fc6a2-13"></a>  <span class="c1"># диаграммы, для начала добавим в него сконвертированную таблицу вероятностей</span>
<a name="rest_code_0d815db3a4734fccb1ee50c8009fc6a2-14"></a>  plotData <span class="o">&lt;-</span> <span class="kp">as.data.frame</span><span class="p">(</span>jointTable<span class="p">)</span>
<a name="rest_code_0d815db3a4734fccb1ee50c8009fc6a2-15"></a>
<a name="rest_code_0d815db3a4734fccb1ee50c8009fc6a2-16"></a>  <span class="c1"># Добавляем в data.frame информацию о ширине каждого из столбцов</span>
<a name="rest_code_0d815db3a4734fccb1ee50c8009fc6a2-17"></a>  plotData<span class="o">$</span>marginVar1 <span class="o">&lt;-</span> <span class="kp">prop.table</span><span class="p">(</span><span class="kp">table</span><span class="p">(</span>var1<span class="p">))</span>
<a name="rest_code_0d815db3a4734fccb1ee50c8009fc6a2-18"></a>
<a name="rest_code_0d815db3a4734fccb1ee50c8009fc6a2-19"></a>  <span class="c1"># Добавляем в data.frame информацию о высоте каждой секции столбца</span>
<a name="rest_code_0d815db3a4734fccb1ee50c8009fc6a2-20"></a>  plotData<span class="o">$</span>var2Height <span class="o">&lt;-</span> plotData<span class="o">$</span>Freq <span class="o">/</span> plotData<span class="o">$</span>marginVar1
<a name="rest_code_0d815db3a4734fccb1ee50c8009fc6a2-21"></a>
<a name="rest_code_0d815db3a4734fccb1ee50c8009fc6a2-22"></a>  <span class="c1"># Добавляем в data.frame информацию о положении центра каждого столбца</span>
<a name="rest_code_0d815db3a4734fccb1ee50c8009fc6a2-23"></a>  plotData<span class="o">$</span>var1Center <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="kp">cumsum</span><span class="p">(</span>plotData<span class="o">$</span>marginVar1<span class="p">)[</span><span class="m">1</span><span class="o">:</span>levVar1 <span class="o">-</span> <span class="m">1</span><span class="p">])</span> <span class="o">+</span>
<a name="rest_code_0d815db3a4734fccb1ee50c8009fc6a2-24"></a>    plotData<span class="o">$</span>marginVar1 <span class="o">/</span> <span class="m">2</span>
<a name="rest_code_0d815db3a4734fccb1ee50c8009fc6a2-25"></a>
<a name="rest_code_0d815db3a4734fccb1ee50c8009fc6a2-26"></a>  <span class="c1"># Строим диаграмму</span>
<a name="rest_code_0d815db3a4734fccb1ee50c8009fc6a2-27"></a>  ggplot<span class="p">(</span>plotData<span class="p">,</span> aes<span class="p">(</span>var1Center<span class="p">,</span> var2Height<span class="p">))</span> <span class="o">+</span>
<a name="rest_code_0d815db3a4734fccb1ee50c8009fc6a2-28"></a>    geom_bar<span class="p">(</span>stat <span class="o">=</span> <span class="s">"identity"</span><span class="p">,</span> aes<span class="p">(</span>width <span class="o">=</span> marginVar1<span class="p">,</span> fill <span class="o">=</span> var2<span class="p">),</span>
<a name="rest_code_0d815db3a4734fccb1ee50c8009fc6a2-29"></a>             col <span class="o">=</span> <span class="s">"black"</span><span class="p">)</span> <span class="o">+</span>
<a name="rest_code_0d815db3a4734fccb1ee50c8009fc6a2-30"></a>
<a name="rest_code_0d815db3a4734fccb1ee50c8009fc6a2-31"></a>    <span class="c1"># Подписи над столбцами</span>
<a name="rest_code_0d815db3a4734fccb1ee50c8009fc6a2-32"></a>    geom_text<span class="p">(</span>aes<span class="p">(</span>label <span class="o">=</span> <span class="kp">as.character</span><span class="p">(</span>var1<span class="p">),</span> x <span class="o">=</span> var1Center<span class="p">,</span>
<a name="rest_code_0d815db3a4734fccb1ee50c8009fc6a2-33"></a>                 y <span class="o">=</span> <span class="m">1.05</span><span class="p">),</span> size <span class="o">=</span> <span class="m">3</span><span class="p">,</span> color <span class="o">=</span> <span class="s">"black"</span><span class="p">)</span> <span class="o">+</span>
<a name="rest_code_0d815db3a4734fccb1ee50c8009fc6a2-34"></a>
<a name="rest_code_0d815db3a4734fccb1ee50c8009fc6a2-35"></a>    <span class="c1"># Изменяем название легенды и меняем цветовую схему</span>
<a name="rest_code_0d815db3a4734fccb1ee50c8009fc6a2-36"></a>    scale_fill_brewer<span class="p">(</span>name<span class="o">=</span><span class="s">"Clarity"</span><span class="p">,</span> palette <span class="o">=</span> <span class="s">"Set2"</span><span class="p">)</span> <span class="o">+</span>
<a name="rest_code_0d815db3a4734fccb1ee50c8009fc6a2-37"></a>
<a name="rest_code_0d815db3a4734fccb1ee50c8009fc6a2-38"></a>    <span class="c1"># Черно-белая тема для окружения</span>
<a name="rest_code_0d815db3a4734fccb1ee50c8009fc6a2-39"></a>    theme_bw<span class="p">()</span> <span class="o">+</span>
<a name="rest_code_0d815db3a4734fccb1ee50c8009fc6a2-40"></a>
<a name="rest_code_0d815db3a4734fccb1ee50c8009fc6a2-41"></a>    <span class="c1"># Убираем названия осей</span>
<a name="rest_code_0d815db3a4734fccb1ee50c8009fc6a2-42"></a>    labs<span class="p">(</span>x <span class="o">=</span> <span class="kc">NULL</span><span class="p">,</span> y <span class="o">=</span> <span class="kc">NULL</span><span class="p">,</span> fill <span class="o">=</span> <span class="kc">NULL</span><span class="p">)</span> <span class="o">+</span>
<a name="rest_code_0d815db3a4734fccb1ee50c8009fc6a2-43"></a>
<a name="rest_code_0d815db3a4734fccb1ee50c8009fc6a2-44"></a>    <span class="c1"># Сетка на фоне не нужна</span>
<a name="rest_code_0d815db3a4734fccb1ee50c8009fc6a2-45"></a>    theme<span class="p">(</span>panel.grid.major <span class="o">=</span> element_line<span class="p">(</span>colour <span class="o">=</span> <span class="kc">NA</span><span class="p">),</span>
<a name="rest_code_0d815db3a4734fccb1ee50c8009fc6a2-46"></a>          panel.grid.minor <span class="o">=</span> element_line<span class="p">(</span>colour <span class="o">=</span> <span class="kc">NA</span><span class="p">))</span>
<a name="rest_code_0d815db3a4734fccb1ee50c8009fc6a2-47"></a>
<a name="rest_code_0d815db3a4734fccb1ee50c8009fc6a2-48"></a>  <span class="p">}</span>
<a name="rest_code_0d815db3a4734fccb1ee50c8009fc6a2-49"></a>
<a name="rest_code_0d815db3a4734fccb1ee50c8009fc6a2-50"></a><span class="c1"># Строим мозаичную диаграмму, переменные: качество огранки vs. чистота</span>
<a name="rest_code_0d815db3a4734fccb1ee50c8009fc6a2-51"></a>ggMMplot<span class="p">(</span>diamonds<span class="o">$</span><span class="kp">cut</span><span class="p">,</span> diamonds<span class="o">$</span>clarity<span class="p">)</span>
</pre>
<a class="reference external image-reference" href="images/2014/11/03/mosaic-plot/unnamed-chunk-1-1.png"><img alt="/images/2014/11/03/mosaic-plot/unnamed-chunk-1-1.thumbnail.png" class="align-center" src="images/2014/11/03/mosaic-plot/unnamed-chunk-1-1.thumbnail.png"></a>
<p>Что почитать еще? Из всех источников, что мне попались в процессе поиска, я
могу посоветовать взглянуть на пост из <a class="reference external" href="http://is-r.tumblr.com/post/33290921643/simple-marimekko-mosaic-plots">блога</a>, который ведут
Christopher DeSante и David Sparks (Университет Дьюка). Если вы
хотите разместить на диаграмме больше текста - изучите подробнее пост в
<a class="reference external" href="http://learnr.wordpress.com/2009/03/29/ggplot2_marimekko_mosaic_chart/">Learning R</a>.</p>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/2014/10/19/marginal-plots/" class="u-url">Диаграмма рассеяния с коробчатыми диаграммами по периметру</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Pavel Karateev
            </span></p>
            <p class="dateline"><a href="posts/2014/10/19/marginal-plots/" rel="bookmark"><time class="published dt-published" datetime="2014-10-19T00:00:00+03:00" title="2014-10-19 00:00">2014-10-19 00:00</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<p>В последнее время при работе с R и RStudio мне с изрядной периодичностью
приходится пользоваться коробчатыми диаграммами совместно с диаграммами
рассеяния, к сожалению, в <tt class="docutils literal">ggplot2</tt> не существует (или я её еще не нашел)
простой возможности удобного совместного расположения диаграмм таким образом,
чтобы учитывались границы, интервалы и поля.</p>
<p>После изучения ряда инструкций по реализации требуемого функционала, я пришел к
выводу что способ <a class="reference external" href="https://www.blogger.com/profile/02889896298552826810">Sandy Muspratt</a>, опубликованный в его <a class="reference external" href="http://sandymuspratt.blogspot.ru/2013/02/scatterplot-with-marginal-boxplots.html">блоге</a>,
является лучшим решением с точки зрения простоты и изящества.</p>
<p>Ниже представлен пример реализации, оригинал можно найти в блоге Сэнди.</p>
<p>Ссылки:</p>
<ul class="simple">
<li><a class="reference external" href="http://sandymuspratt.blogspot.ru/2013/02/scatterplot-with-marginal-boxplots.html">Sandy Muspratt's blog post</a></li>
<li><a class="reference external" href="http://docs.ggplot2.org/0.9.3.1/geom_boxplot.html">ggplot2 boxplot docs</a></li>
</ul>
<div class="section" id="id1">
<h2>Пакеты</h2>
<p>Помимо <tt class="docutils literal">ggplot2</tt> для корректного расположения диаграмм в строгом порядке
пригодятся пакеты <tt class="docutils literal">grid</tt> и <tt class="docutils literal">gtable</tt>.</p>
<pre class="code r"><a name="rest_code_077688382a7d45e4b64f5dce1c97565c-1"></a><span class="kn">library</span><span class="p">(</span>ggplot2<span class="p">)</span>
</pre>
<pre class="code text"><a name="rest_code_02a2d3a7cd2b4216bc0369170e7d4172-1"></a>## Loading required package: methods
</pre>
<pre class="code r"><a name="rest_code_ee4513ead3044522a8dae99597f4ec9d-1"></a><span class="kn">library</span><span class="p">(</span>grid<span class="p">)</span>
<a name="rest_code_ee4513ead3044522a8dae99597f4ec9d-2"></a><span class="kn">library</span><span class="p">(</span>gtable<span class="p">)</span>
</pre>
</div>
<div class="section" id="id2">
<h2>Данные</h2>
<p>В качестве примера возьмем предустановленный массив данных <tt class="docutils literal">mtcars</tt>.</p>
<pre class="code r"><a name="rest_code_292eaa60fa02421890b60adc825c1f0f-1"></a>data<span class="p">(</span>mtcars<span class="p">)</span>
</pre>
</div>
<div class="section" id="id3">
<h2>Диаграмма рассеяния</h2>
<p>Для начала построим диаграмму рассеяния, помимо стандартного взова <tt class="docutils literal">ggplot</tt> и
<tt class="docutils literal">geom_point()</tt> нам потребуется пересчитать отображаемые границы диапазона
данных. <tt class="docutils literal">ggplot2</tt> делает это по умолчанию с эстетической целью - точки данных
так не будут совпадать с осями, однако нам нужно настроить границы точно для
позиционирования коробочных диаграмм.</p>
<pre class="code r"><a name="rest_code_a97f7b1ac6d0498fb3844f2b35aad962-1"></a>p1 <span class="o">&lt;-</span> ggplot<span class="p">(</span>mtcars<span class="p">,</span> aes<span class="p">(</span>mpg<span class="p">,</span> hp<span class="p">))</span> <span class="o">+</span>
<a name="rest_code_a97f7b1ac6d0498fb3844f2b35aad962-2"></a>  geom_point<span class="p">()</span> <span class="o">+</span>
<a name="rest_code_a97f7b1ac6d0498fb3844f2b35aad962-3"></a>
<a name="rest_code_a97f7b1ac6d0498fb3844f2b35aad962-4"></a>  <span class="c1"># Удаляем дополнительные поля к отображаемому диапазону данных</span>
<a name="rest_code_a97f7b1ac6d0498fb3844f2b35aad962-5"></a>  scale_x_continuous<span class="p">(</span>expand <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">))</span> <span class="o">+</span>
<a name="rest_code_a97f7b1ac6d0498fb3844f2b35aad962-6"></a>  scale_y_continuous<span class="p">(</span>expand <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">))</span> <span class="o">+</span>
<a name="rest_code_a97f7b1ac6d0498fb3844f2b35aad962-7"></a>
<a name="rest_code_a97f7b1ac6d0498fb3844f2b35aad962-8"></a>  <span class="c1"># Пересчитываем дополнительные поля</span>
<a name="rest_code_a97f7b1ac6d0498fb3844f2b35aad962-9"></a>  expand_limits<span class="p">(</span>y <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="kp">min</span><span class="p">(</span>mtcars<span class="o">$</span>hp<span class="p">)</span> <span class="o">-</span> <span class="m">0.1</span> <span class="o">*</span> <span class="kp">diff</span><span class="p">(</span><span class="kp">range</span><span class="p">(</span>mtcars<span class="o">$</span>hp<span class="p">)),</span>
<a name="rest_code_a97f7b1ac6d0498fb3844f2b35aad962-10"></a>    <span class="kp">max</span><span class="p">(</span>mtcars<span class="o">$</span>hp<span class="p">)</span> <span class="o">+</span> <span class="m">0.1</span> <span class="o">*</span> <span class="kp">diff</span><span class="p">(</span><span class="kp">range</span><span class="p">(</span>mtcars<span class="o">$</span>hp<span class="p">))))</span> <span class="o">+</span>
<a name="rest_code_a97f7b1ac6d0498fb3844f2b35aad962-11"></a>  expand_limits<span class="p">(</span>x <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="kp">min</span><span class="p">(</span>mtcars<span class="o">$</span>mpg<span class="p">)</span> <span class="o">-</span> <span class="m">0.1</span> <span class="o">*</span> <span class="kp">diff</span><span class="p">(</span><span class="kp">range</span><span class="p">(</span>mtcars<span class="o">$</span>mpg<span class="p">)),</span>
<a name="rest_code_a97f7b1ac6d0498fb3844f2b35aad962-12"></a>    <span class="kp">max</span><span class="p">(</span>mtcars<span class="o">$</span>mpg<span class="p">)</span> <span class="o">+</span> <span class="m">0.1</span> <span class="o">*</span> <span class="kp">diff</span><span class="p">(</span><span class="kp">range</span><span class="p">(</span>mtcars<span class="o">$</span>mpg<span class="p">))))</span> <span class="o">+</span>
<a name="rest_code_a97f7b1ac6d0498fb3844f2b35aad962-13"></a>
<a name="rest_code_a97f7b1ac6d0498fb3844f2b35aad962-14"></a>  <span class="c1"># Настраиваем внешние границы</span>
<a name="rest_code_a97f7b1ac6d0498fb3844f2b35aad962-15"></a>  theme<span class="p">(</span>plot.margin <span class="o">=</span> unit<span class="p">(</span><span class="kt">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0.5</span><span class="p">,</span> <span class="m">0.5</span><span class="p">),</span> <span class="s">"lines"</span><span class="p">))</span>
</pre>
</div>
<div class="section" id="id4">
<h2>Коробчатые диаграммы</h2>
<p>Строим коробчатые диаграммы, при этом настраиваем внешние границы графиков и
границы отображаемого диапазона для соответствия диаграмме рассеяния.
Дополнительно удаляем оси коробчатых диаграмм - они нам не нужны.</p>
<pre class="code r"><a name="rest_code_479e238c1f944b3e833f42090e6f2c0b-1"></a><span class="c1"># Создаем тему без названий осей и меток</span>
<a name="rest_code_479e238c1f944b3e833f42090e6f2c0b-2"></a>theme_remove_all <span class="o">&lt;-</span> theme<span class="p">(</span>axis.text <span class="o">=</span> element_blank<span class="p">(),</span>
<a name="rest_code_479e238c1f944b3e833f42090e6f2c0b-3"></a>  axis.title <span class="o">=</span> element_blank<span class="p">(),</span>
<a name="rest_code_479e238c1f944b3e833f42090e6f2c0b-4"></a>  axis.ticks <span class="o">=</span> element_blank<span class="p">(),</span>
<a name="rest_code_479e238c1f944b3e833f42090e6f2c0b-5"></a>  axis.ticks.margin <span class="o">=</span> unit<span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="s">"lines"</span><span class="p">),</span>
<a name="rest_code_479e238c1f944b3e833f42090e6f2c0b-6"></a>  axis.ticks.length <span class="o">=</span> unit<span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="s">"cm"</span><span class="p">))</span>
<a name="rest_code_479e238c1f944b3e833f42090e6f2c0b-7"></a>
<a name="rest_code_479e238c1f944b3e833f42090e6f2c0b-8"></a><span class="c1"># Горизонтальная коробчатая диаграмма</span>
<a name="rest_code_479e238c1f944b3e833f42090e6f2c0b-9"></a>p2 <span class="o">&lt;-</span> ggplot<span class="p">(</span>mtcars<span class="p">,</span> aes<span class="p">(</span>x <span class="o">=</span> <span class="kp">factor</span><span class="p">(</span><span class="m">1</span><span class="p">),</span> y <span class="o">=</span> mpg<span class="p">))</span> <span class="o">+</span>
<a name="rest_code_479e238c1f944b3e833f42090e6f2c0b-10"></a>  <span class="c1"># Строим границы (whiskers) коробчатой диаграммы</span>
<a name="rest_code_479e238c1f944b3e833f42090e6f2c0b-11"></a>  stat_boxplot<span class="p">(</span>geom <span class="o">=</span><span class="s">'errorbar'</span><span class="p">)</span> <span class="o">+</span>
<a name="rest_code_479e238c1f944b3e833f42090e6f2c0b-12"></a>
<a name="rest_code_479e238c1f944b3e833f42090e6f2c0b-13"></a>  <span class="c1"># Сама диаграмма</span>
<a name="rest_code_479e238c1f944b3e833f42090e6f2c0b-14"></a>  geom_boxplot<span class="p">()</span> <span class="o">+</span>
<a name="rest_code_479e238c1f944b3e833f42090e6f2c0b-15"></a>
<a name="rest_code_479e238c1f944b3e833f42090e6f2c0b-16"></a>  <span class="c1"># Удаляем дополнительные поля к отображаемому диапазону данных</span>
<a name="rest_code_479e238c1f944b3e833f42090e6f2c0b-17"></a>  scale_y_continuous<span class="p">(</span>expand <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">))</span> <span class="o">+</span>
<a name="rest_code_479e238c1f944b3e833f42090e6f2c0b-18"></a>
<a name="rest_code_479e238c1f944b3e833f42090e6f2c0b-19"></a>  <span class="c1"># Пересчитываем дополнительные поля</span>
<a name="rest_code_479e238c1f944b3e833f42090e6f2c0b-20"></a>  expand_limits<span class="p">(</span>y <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="kp">min</span><span class="p">(</span>mtcars<span class="o">$</span>mpg<span class="p">)</span> <span class="o">-</span> <span class="m">0.1</span> <span class="o">*</span> <span class="kp">diff</span><span class="p">(</span><span class="kp">range</span><span class="p">(</span>mtcars<span class="o">$</span>mpg<span class="p">)),</span>
<a name="rest_code_479e238c1f944b3e833f42090e6f2c0b-21"></a>                      <span class="kp">max</span><span class="p">(</span>mtcars<span class="o">$</span>mpg<span class="p">)</span> <span class="o">+</span> <span class="m">0.1</span> <span class="o">*</span> <span class="kp">diff</span><span class="p">(</span><span class="kp">range</span><span class="p">(</span>mtcars<span class="o">$</span>mpg<span class="p">))))</span> <span class="o">+</span>
<a name="rest_code_479e238c1f944b3e833f42090e6f2c0b-22"></a>
<a name="rest_code_479e238c1f944b3e833f42090e6f2c0b-23"></a>  <span class="c1"># Поворачиваем диаграмму (по умолчанию коробчатые диаграммы вертикальны)</span>
<a name="rest_code_479e238c1f944b3e833f42090e6f2c0b-24"></a>  coord_flip<span class="p">()</span> <span class="o">+</span>
<a name="rest_code_479e238c1f944b3e833f42090e6f2c0b-25"></a>
<a name="rest_code_479e238c1f944b3e833f42090e6f2c0b-26"></a>  <span class="c1"># Применяем тему с удаленными осями</span>
<a name="rest_code_479e238c1f944b3e833f42090e6f2c0b-27"></a>  theme_remove_all <span class="o">+</span>
<a name="rest_code_479e238c1f944b3e833f42090e6f2c0b-28"></a>
<a name="rest_code_479e238c1f944b3e833f42090e6f2c0b-29"></a>  <span class="c1"># Изменяем внешние поля</span>
<a name="rest_code_479e238c1f944b3e833f42090e6f2c0b-30"></a>  theme<span class="p">(</span>plot.margin<span class="o">=</span> unit<span class="p">(</span><span class="kt">c</span><span class="p">(</span><span class="m">0.5</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0.5</span><span class="p">),</span> <span class="s">"lines"</span><span class="p">))</span>
<a name="rest_code_479e238c1f944b3e833f42090e6f2c0b-31"></a>
<a name="rest_code_479e238c1f944b3e833f42090e6f2c0b-32"></a><span class="c1"># Вертикальная коробчатая диаграмма</span>
<a name="rest_code_479e238c1f944b3e833f42090e6f2c0b-33"></a>p3 <span class="o">&lt;-</span> ggplot<span class="p">(</span>mtcars<span class="p">,</span> aes<span class="p">(</span>x <span class="o">=</span> <span class="kp">factor</span><span class="p">(</span><span class="m">1</span><span class="p">),</span> y <span class="o">=</span> hp<span class="p">))</span> <span class="o">+</span>
<a name="rest_code_479e238c1f944b3e833f42090e6f2c0b-34"></a>  <span class="c1"># Строим границы (whiskers) коробчатой диаграммы</span>
<a name="rest_code_479e238c1f944b3e833f42090e6f2c0b-35"></a>  stat_boxplot<span class="p">(</span>geom <span class="o">=</span><span class="s">'errorbar'</span><span class="p">)</span> <span class="o">+</span>
<a name="rest_code_479e238c1f944b3e833f42090e6f2c0b-36"></a>
<a name="rest_code_479e238c1f944b3e833f42090e6f2c0b-37"></a>  <span class="c1"># Сама диаграмма</span>
<a name="rest_code_479e238c1f944b3e833f42090e6f2c0b-38"></a>  geom_boxplot<span class="p">()</span> <span class="o">+</span>
<a name="rest_code_479e238c1f944b3e833f42090e6f2c0b-39"></a>
<a name="rest_code_479e238c1f944b3e833f42090e6f2c0b-40"></a>  <span class="c1"># Удаляем дополнительные поля к отображаемому диапазону данных</span>
<a name="rest_code_479e238c1f944b3e833f42090e6f2c0b-41"></a>  scale_y_continuous<span class="p">(</span>expand <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">))</span> <span class="o">+</span>
<a name="rest_code_479e238c1f944b3e833f42090e6f2c0b-42"></a>
<a name="rest_code_479e238c1f944b3e833f42090e6f2c0b-43"></a>  <span class="c1"># Пересчитываем дополнительные поля</span>
<a name="rest_code_479e238c1f944b3e833f42090e6f2c0b-44"></a>  expand_limits<span class="p">(</span>y <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="kp">min</span><span class="p">(</span>mtcars<span class="o">$</span>hp<span class="p">)</span> <span class="o">-</span> <span class="m">0.1</span> <span class="o">*</span> <span class="kp">diff</span><span class="p">(</span><span class="kp">range</span><span class="p">(</span>mtcars<span class="o">$</span>hp<span class="p">)),</span>
<a name="rest_code_479e238c1f944b3e833f42090e6f2c0b-45"></a>                      <span class="kp">max</span><span class="p">(</span>mtcars<span class="o">$</span>hp<span class="p">)</span> <span class="o">+</span> <span class="m">0.1</span> <span class="o">*</span> <span class="kp">diff</span><span class="p">(</span><span class="kp">range</span><span class="p">(</span>mtcars<span class="o">$</span>hp<span class="p">))))</span> <span class="o">+</span>
<a name="rest_code_479e238c1f944b3e833f42090e6f2c0b-46"></a>
<a name="rest_code_479e238c1f944b3e833f42090e6f2c0b-47"></a>  <span class="c1"># Применяем тему с удаленными осями</span>
<a name="rest_code_479e238c1f944b3e833f42090e6f2c0b-48"></a>  theme_remove_all <span class="o">+</span>
<a name="rest_code_479e238c1f944b3e833f42090e6f2c0b-49"></a>
<a name="rest_code_479e238c1f944b3e833f42090e6f2c0b-50"></a>  <span class="c1"># Изменяем внешние поля</span>
<a name="rest_code_479e238c1f944b3e833f42090e6f2c0b-51"></a>  theme<span class="p">(</span>plot.margin<span class="o">=</span> unit<span class="p">(</span><span class="kt">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0.5</span><span class="p">,</span> <span class="m">0.5</span><span class="p">,</span> <span class="m">0</span><span class="p">),</span> <span class="s">"lines"</span><span class="p">))</span>
</pre>
</div>
<div class="section" id="gtables">
<h2>gtables</h2>
<p>Создаем объекты <tt class="docutils literal">gtable</tt> с диаграммами для последующей верстки.</p>
<pre class="code text"><a name="rest_code_df17f08931364d82b107e530c278ba29-1"></a>gt1 &lt;- ggplot_gtable(ggplot_build(p1)) # Диаграмма рассеяния
<a name="rest_code_df17f08931364d82b107e530c278ba29-2"></a>gt2 &lt;- ggplot_gtable(ggplot_build(p2)) # Коробчатая горизонтальная диаграмма
<a name="rest_code_df17f08931364d82b107e530c278ba29-3"></a>gt3 &lt;- ggplot_gtable(ggplot_build(p3)) # Коробчатая вертикальная диаграмма
</pre>
</div>
<div class="section" id="id5">
<h2>Настройка высоты и ширины</h2>
<p>В <tt class="docutils literal">gtable</tt> хранится вся информация, необходимая для построения графиков, в том
числе и поля, выделяемые для отображения меток и названий осей. Нам нужно
перезадать ширину и высоту диаграмм, чтобы верхняя коробчатая диаграмма не
"налезала" на воображаемую ось Y диаграммы рассеяния, а коробчатая диаграмма
справа не пересекала ось X.</p>
<pre class="code r"><a name="rest_code_567fac0ac23d43968a636181bcb4fc69-1"></a><span class="c1"># Максимальная высота и ширина</span>
<a name="rest_code_567fac0ac23d43968a636181bcb4fc69-2"></a>maxWidth <span class="o">&lt;-</span> unit.pmax<span class="p">(</span>gt1<span class="o">$</span>widths<span class="p">[</span><span class="m">2</span><span class="o">:</span><span class="m">3</span><span class="p">],</span> gt2<span class="o">$</span>widths<span class="p">[</span><span class="m">2</span><span class="o">:</span><span class="m">3</span><span class="p">])</span>
<a name="rest_code_567fac0ac23d43968a636181bcb4fc69-3"></a>maxHeight <span class="o">&lt;-</span> unit.pmax<span class="p">(</span>gt1<span class="o">$</span>heights<span class="p">[</span><span class="m">4</span><span class="o">:</span><span class="m">5</span><span class="p">],</span> gt3<span class="o">$</span>heights<span class="p">[</span><span class="m">4</span><span class="o">:</span><span class="m">5</span><span class="p">])</span>
<a name="rest_code_567fac0ac23d43968a636181bcb4fc69-4"></a>
<a name="rest_code_567fac0ac23d43968a636181bcb4fc69-5"></a><span class="c1"># Задаем максимальные значения высоты и ширины в gtables для gt1, gt2 и gt3</span>
<a name="rest_code_567fac0ac23d43968a636181bcb4fc69-6"></a>gt1<span class="o">$</span>widths<span class="p">[</span><span class="m">2</span><span class="o">:</span><span class="m">3</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="kp">as.list</span><span class="p">(</span>maxWidth<span class="p">)</span>
<a name="rest_code_567fac0ac23d43968a636181bcb4fc69-7"></a>gt2<span class="o">$</span>widths<span class="p">[</span><span class="m">2</span><span class="o">:</span><span class="m">3</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="kp">as.list</span><span class="p">(</span>maxWidth<span class="p">)</span>
<a name="rest_code_567fac0ac23d43968a636181bcb4fc69-8"></a>
<a name="rest_code_567fac0ac23d43968a636181bcb4fc69-9"></a>gt1<span class="o">$</span>heights<span class="p">[</span><span class="m">4</span><span class="o">:</span><span class="m">5</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="kp">as.list</span><span class="p">(</span>maxHeight<span class="p">)</span>
<a name="rest_code_567fac0ac23d43968a636181bcb4fc69-10"></a>gt3<span class="o">$</span>heights<span class="p">[</span><span class="m">4</span><span class="o">:</span><span class="m">5</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="kp">as.list</span><span class="p">(</span>maxHeight<span class="p">)</span>
</pre>
</div>
<div class="section" id="id6">
<h2>Верстка</h2>
<pre class="code r"><a name="rest_code_fc5745a3fc4f42948f0434888e968fff-1"></a><span class="c1"># Создаем новую пустую gtable</span>
<a name="rest_code_fc5745a3fc4f42948f0434888e968fff-2"></a>gt <span class="o">&lt;-</span> gtable<span class="p">(</span>widths <span class="o">=</span> unit<span class="p">(</span><span class="kt">c</span><span class="p">(</span><span class="m">7</span><span class="p">,</span> <span class="m">1</span><span class="p">),</span> <span class="s">"null"</span><span class="p">),</span> height <span class="o">=</span> unit<span class="p">(</span><span class="kt">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">7</span><span class="p">),</span> <span class="s">"null"</span><span class="p">))</span>
<a name="rest_code_fc5745a3fc4f42948f0434888e968fff-3"></a>
<a name="rest_code_fc5745a3fc4f42948f0434888e968fff-4"></a><span class="c1"># Вставляем gt1, gt2 и gt3 в gt</span>
<a name="rest_code_fc5745a3fc4f42948f0434888e968fff-5"></a>gt <span class="o">&lt;-</span> gtable_add_grob<span class="p">(</span>gt<span class="p">,</span> gt1<span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">1</span><span class="p">)</span>
<a name="rest_code_fc5745a3fc4f42948f0434888e968fff-6"></a>gt <span class="o">&lt;-</span> gtable_add_grob<span class="p">(</span>gt<span class="p">,</span> gt2<span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">)</span>
<a name="rest_code_fc5745a3fc4f42948f0434888e968fff-7"></a>gt <span class="o">&lt;-</span> gtable_add_grob<span class="p">(</span>gt<span class="p">,</span> gt3<span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">2</span><span class="p">)</span>
<a name="rest_code_fc5745a3fc4f42948f0434888e968fff-8"></a>
<a name="rest_code_fc5745a3fc4f42948f0434888e968fff-9"></a><span class="c1"># Строим рисунок</span>
<a name="rest_code_fc5745a3fc4f42948f0434888e968fff-10"></a>grid.newpage<span class="p">()</span>
<a name="rest_code_fc5745a3fc4f42948f0434888e968fff-11"></a>grid.draw<span class="p">(</span>gt<span class="p">)</span>
</pre>
<a class="reference external image-reference" href="images/2014/10/19/marginal-plots/unnamed-chunk-1-1.png"><img alt="/images/2014/10/19/marginal-plots/unnamed-chunk-1-1.thumbnail.png" class="align-center" src="images/2014/10/19/marginal-plots/unnamed-chunk-1-1.thumbnail.png"></a>
</div>
</div>
    </div>
    </article>
</div>







         </main><footer id="footer"><p>Contents © 2017         <a href="mailto:karateev.pavel@ya.ru">Pavel Karateev</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         </p>
            
        </footer>
</div>
    
    

        <script src="assets/js/baguetteBox.min.js"></script><script>baguetteBox.run('a.reference', {
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});</script>
</body>
</html>
